<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Activity 5: Dealing with overdispersion in multi-cluster studies – Malaria Molecular Surveillance Study Design workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8610558a007458a9b978551a034f4d85.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Malaria Molecular Surveillance Study Design workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-events" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-calendar" role="img">
</i> 
 <span class="menu-text">Events</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-events">    
        <li>
    <a class="dropdown-item" href="../../events.html">
 <span class="dropdown-text">Events overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../workshop2024.html">
 <span class="dropdown-text">2024 New Orleans Workshop</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../workshop2025.html">
 <span class="dropdown-text">2025 Toronto workshop (upcoming)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../lectures.html"> <i class="bi bi-bookmark" role="img">
</i> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../../tutorials.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module1/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 1 - Sampling from a population</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module2/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 2 - Sample size calculation based on margin of error</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module3/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 3 - Hypothesis testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module4/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 4 - Statistical power</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module5/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 5 - Dealing with overdispersion in multi-cluster studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://shiny.dide.ic.ac.uk/mms-sd-workshop/module6/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 6 - The DRpower tool</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/module7/module7_scenarios.html"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 7 - Designing a study for multiple end-points</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  </ul></li>
  <li><a href="#analyzing-data-from-a-multi-cluster-pfhrp23-deletion-study" id="toc-analyzing-data-from-a-multi-cluster-pfhrp23-deletion-study" class="nav-link" data-scroll-target="#analyzing-data-from-a-multi-cluster-pfhrp23-deletion-study">Analyzing data from a multi-cluster <em>pfhrp2/3</em> deletion study</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#estimating-the-global-prevalence" id="toc-estimating-the-global-prevalence" class="nav-link" data-scroll-target="#estimating-the-global-prevalence">Estimating the global prevalence</a></li>
  <li><a href="#detecting-overdispersion" id="toc-detecting-overdispersion" class="nav-link" data-scroll-target="#detecting-overdispersion">Detecting overdispersion</a></li>
  </ul></li>
  <li><a href="#quantifying-overdispersion" id="toc-quantifying-overdispersion" class="nav-link" data-scroll-target="#quantifying-overdispersion">Quantifying overdispersion</a>
  <ul class="collapse">
  <li><a href="#the-design-effect" id="toc-the-design-effect" class="nav-link" data-scroll-target="#the-design-effect">The design effect</a></li>
  <li><a href="#the-effective-sample-size" id="toc-the-effective-sample-size" class="nav-link" data-scroll-target="#the-effective-sample-size">The effective sample size</a></li>
  <li><a href="#the-intra-cluster-correlation-coefficient" id="toc-the-intra-cluster-correlation-coefficient" class="nav-link" data-scroll-target="#the-intra-cluster-correlation-coefficient">The intra-cluster correlation coefficient</a></li>
  </ul></li>
  <li><a href="#accounting-for-overdispersion-in-analysis" id="toc-accounting-for-overdispersion-in-analysis" class="nav-link" data-scroll-target="#accounting-for-overdispersion-in-analysis">Accounting for overdispersion in analysis</a>
  <ul class="collapse">
  <li><a href="#overdispersion-and-confidence-intervals" id="toc-overdispersion-and-confidence-intervals" class="nav-link" data-scroll-target="#overdispersion-and-confidence-intervals">Overdispersion and confidence intervals</a></li>
  <li><a href="#overdispersion-and-hypothesis-testing" id="toc-overdispersion-and-hypothesis-testing" class="nav-link" data-scroll-target="#overdispersion-and-hypothesis-testing">Overdispersion and hypothesis testing</a></li>
  </ul></li>
  <li><a href="#accounting-for-overdispersion-in-design" id="toc-accounting-for-overdispersion-in-design" class="nav-link" data-scroll-target="#accounting-for-overdispersion-in-design">Accounting for overdispersion in design</a>
  <ul class="collapse">
  <li><a href="#overdispersion-and-power" id="toc-overdispersion-and-power" class="nav-link" data-scroll-target="#overdispersion-and-power">Overdispersion and power</a></li>
  <li><a href="#overdispersion-and-sample-size" id="toc-overdispersion-and-sample-size" class="nav-link" data-scroll-target="#overdispersion-and-sample-size">Overdispersion and sample size</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Activity 5: Dealing with overdispersion in multi-cluster studies</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to Activity 5: <strong>Dealing with overdispersion in multi-cluster studies</strong></p>
<p>In this activity, we will explore the unique features of multi-cluster studies that differentiate them from single-cluster studies. In malaria surveillance, it is common to pool information from multiple sites, such as health facilities, towns, or even regions within a country. Combining data across sites allows us to draw broader conclusions at a higher geographic or administrative level. However, multi-cluster studies often face the challenge of <em>overdispersion</em>, where variability between sites exceeds what we would expect by chance. Overdispersion can reduce the precision of our estimates and lower statistical power, making it crucial to account for this phenomenon in our analyses.</p>
<section id="learning-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h3>
<p>By the end of this tutorial, you will be able to:</p>
<ul>
<li>Detect overdispersion</li>
<li>Quantify overdispersion using three metrics; 1) the design effect, 2) the effective sample size, and 3) the intra-cluster correlation coefficient</li>
<li>Understand the impact of overdispersion on statistical efficiency</li>
<li>Construct confidence intervals and perform hypothesis tests that account for overdispersion</li>
</ul>
<p><em>Disclaimer: The scenarios in this document are entirely fictitious. While real place names are used, the data itself is artificial and designed for teaching purposes only. It does not necessarily represent the real epidemiological situation in these locations.</em></p>
</section>
</section>
<section id="analyzing-data-from-a-multi-cluster-pfhrp23-deletion-study" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-data-from-a-multi-cluster-pfhrp23-deletion-study">Analyzing data from a multi-cluster <em>pfhrp2/3</em> deletion study</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>You are collaborating with the Tanzanian National Malaria Control Programme (NMCP) to investigate the prevalence of <em>pfhrp2/3</em> gene deletions in the Dodoma region of Tanzania. These gene deletions pose a significant threat to malaria control efforts because they can lead to parasites being undetectable by rapid diagnostic tests (RDTs) that rely on the HRP2 protein. Undetected cases may lead to delays in treatment or missed malaria diagnoses, undermining effective case management.</p>
<p>A multi-cluster study has been performed in 8 sites within the Dodoma region. The results of this study are shown below:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confirmed Malaria<br>
(n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2/3 Deleted<br>
(x)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2/3 Deletion Prevalence<br>
(p = x / n)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Chalinze</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Ibwaga</td>
<td style="text-align: right; width: 3cm;">80</td>
<td style="text-align: right; width: 3cm;">12</td>
<td style="text-align: right; width: 4cm;">0.150</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Lukali</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Malolo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">26</td>
<td style="text-align: right; width: 4cm;">0.260</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Mafene</td>
<td style="text-align: right; width: 3cm;">95</td>
<td style="text-align: right; width: 3cm;">25</td>
<td style="text-align: right; width: 4cm;">0.263</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Mpendo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">45</td>
<td style="text-align: right; width: 4cm;">0.450</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Nhinhi</td>
<td style="text-align: right; width: 3cm;">50</td>
<td style="text-align: right; width: 3cm;">0</td>
<td style="text-align: right; width: 4cm;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Rudi</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">11</td>
<td style="text-align: right; width: 4cm;">0.110</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup><br>
Table 1: pfhrp2/3 deletion data broken down by site</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
<p>In the R chunks below, you will be able to access the columns of this table through the variables <code>n</code>, <code>x</code>, and <code>p</code>, as shown here:</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sandbox-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can access the following vectors</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
</section>
<section id="estimating-the-global-prevalence" class="level3">
<h3 class="anchored" data-anchor-id="estimating-the-global-prevalence">Estimating the global prevalence</h3>
<p>We want to use the information over all 8 sites to estimate the prevalence of <em>pfhrp2/3</em> deletions in the Dodoma region as a whole. This is often refered to as the “global” prevalence estimate. We will use <span class="math inline">\(\hat{p}\)</span> to denote the global prevalence, and <span class="math inline">\(\hat{p}_i\)</span> to denote the site-level prevalence in the <span class="math inline">\(i^\text{th}\)</span> site.</p>
<p>A common way to calculate <span class="math inline">\(\hat{p}\)</span> is to take the mean over sites.</p>
<p><span class="math display">\[
\hat{p} = \frac{1}{c} \sum_{i=1}^c \hat{p}_i
\]</span></p>
<p>where there are <span class="math inline">\(c\)</span> sites. In our case <span class="math inline">\(c = 8\)</span>.</p>
<p>Complete the following R code to calculate <code>p_global</code> as the mean prevalence over sites. Remember that the values in <strong>Table 1</strong> are available through the variables <code>n</code>, <code>x</code> and <code>p</code>.</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="global-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as mean prevalence over sites</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="global-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as mean prevalence over sites</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> <span class="fu">mean</span>(p)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(\hat{p} = 0.172\)</span>, or 17.2% prevalence.</p>
</details>
<p><br></p>
<p>This calculation ignores differences in sample sizes between sites. For example, the Nhinhi site is given just as much weight as the Rudi site, despite having half the number of confirmed malaria cases. A different approach is to calculate <span class="math inline">\(\hat{p}\)</span> as the <em>weighted</em> average of the site-level prevalence, where the weights are given by the sample sizes. This is mathematically equivalent to summing the numerator, summing the denominator, and then taking the ratio:</p>
<p><span class="math display">\[
\hat{p} = \frac{\sum_{i=1}^c x_i}{\sum_{i=1}^c n_i}
\]</span></p>
<p>Complete the following R code to calculate <code>p_global</code> as the <em>weighted</em> mean prevalence over sites:</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="global-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as weighted mean prevalence over sites</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="global-2-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as weighted mean prevalence over sites</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> <span class="fu">sum</span>(x) <span class="sc">/</span> <span class="fu">sum</span>(n)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(\hat{p} = 0.183\)</span>, or 18.3% prevalence.</p>
</details>
<p><br></p>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Why does the weighted mean give a higher prevalence in this example than the unweighted mean? Look at the prevalence and sample size columns in <strong>Table 1</strong> for a clue. </span></p>
</div>
<p>Although we have seen two ways of calculating the global prevalence, neither approach is more correct than the other, they just have different strengths and weaknesses. The unweighted mean treats each site as a single observation, which is a robust approach when there may be overdispersion. On the other hand, the weighted mean avoids small clusters having a large influence on the final estimate. For the purposes of this activity, we will use the unweighted mean as our global estimate.</p>
</section>
<section id="detecting-overdispersion" class="level3">
<h3 class="anchored" data-anchor-id="detecting-overdispersion">Detecting overdispersion</h3>
<p>Now that we have an estimate of the global prevalence, we can look for <em>overdispersion</em> in the data. If all patients enrolled in the study were completely independent, meaning they all had the same probability <span class="math inline">\(\hat{p}\)</span> of carrying the <em>pfhrp2/3</em> deletion, then we would expect to see a certain level of variation between sites. Most of the time, the site-level prevalence should be within the following 95% interval: <span class="math display">\[
\hat{p} \pm z_{1 - \alpha/2}\sqrt{\frac{\hat{p}(1 - \hat{p})}{n_i}}
\]</span> where <span class="math inline">\(n_i\)</span> is the sample size in the <span class="math inline">\(i^{\text{th}}\)</span> site. This is a 95% interval, meaning we should expect site-level prevalence to fall within this range around 95% of the time. For our study involving 8 sites, we <em>may</em> see one value outside this range by chance, but it would be very unusual to see more than one value outside this range.</p>
<p>The plot below shows the site-level prevalence in red. The global mean prevalence of 17.2% is shown as a horizontal dashed line, and the 95% interval is shown as an error bar.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="activity5_multicluster_interactive_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Detecting overdispersion</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-1-1" class="tutorial-question panel-body">
<div id="quiz-overdispersion-1-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-1-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-1-2" class="tutorial-question panel-body">
<div id="quiz-overdispersion-1-2-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-2-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-2-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-1-3" class="tutorial-question panel-body">
<div id="quiz-overdispersion-1-3-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-3-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-3-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-1-4" class="tutorial-question panel-body">
<div id="quiz-overdispersion-1-4-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-4-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-4-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="quantifying-overdispersion" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-overdispersion">Quantifying overdispersion</h2>
<section id="the-design-effect" class="level3">
<h3 class="anchored" data-anchor-id="the-design-effect">The design effect</h3>
<p>One way of quantifying the effect of overdispersion is through the <strong>design effect</strong>, denoted <span class="math inline">\(D_{\text{eff}}\)</span>. We can estimate the design effect by calculating the observed variance between sites and dividing this by the variance that we would expect under simple random sampling (SRS). If the data are over-dispersed then the observed variance will be greater than expected, meaning <span class="math inline">\(D_{\text{eff}}\)</span> will be greater than 1.</p>
<p>The observed variance, or sample variance, can be calculated using the formula:</p>
<p><span class="math display">\[
\text{Var}_{\text{obs}} = \frac{1}{c-1}\sum_{i=1}^c (\hat{p}_i - \hat{p})^2
\]</span> This formula is found in many areas of statistics. We don’t need to calculate this value by hand, instead we can do it very easily in R using the <code>var()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observed variance between sites</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>var_observed <span class="ot">&lt;-</span> <span class="fu">var</span>(p)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(var_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02114684</code></pre>
</div>
</div>
<p>Next, we need to calculate the variance that we would expect under simple random sampling (SRS). This is given by:</p>
<p><span class="math display">\[
\text{Var}_{\text{SRS}} = \frac{1}{c} \sum_{i=1}^c \frac{\hat{p}(1 - \hat{p})}{n_i}
\]</span> We can calculate this in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected variance under SRS</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>var_SRS <span class="ot">&lt;-</span> <span class="fu">mean</span>(p_global<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> n)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(var_SRS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001653192</code></pre>
</div>
</div>
<p>Finally, we can calculate the design effect as the ratio of these two quantities: <span class="math display">\[
D_{\text{eff}} = \frac{\text{Var}_{\text{obs}}}{\text{Var}_{\text{SRS}}}
\]</span> Complete the following R code to calculate the design effect:</p>
<div class="cell" data-exercise="true" data-exercise.setup="deff-params">
<div class="tutorial-exercise" data-label="deff-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate design effect from the variances</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>D_eff <span class="ot">&lt;-</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(D_eff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="deff-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate design effect from the variances</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>D_eff <span class="ot">&lt;-</span> var_observed <span class="sc">/</span> var_SRS</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(D_eff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(D_{\text{eff}} = 12.79\)</span>.</p>
</details>
<p><br></p>
<p>The design effect is a measure of the statistical <em>inefficiency</em> of a study design. Larger values indicate less efficient designs, with a value of <span class="math inline">\(D_{\text{eff}}=1\)</span> meaning the study design is as efficient as SRS, which is seen as the gold standard for statistical efficiency. Our observed value of <span class="math inline">\(D_{\text{eff}}=12.79\)</span> indicates that our study has a high level of statistical inefficiency, which is caused by overdispersion in the data.</p>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Interpreting the design effect</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-deff-1-1" class="tutorial-question panel-body">
<div id="quiz-deff-1-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-deff-1-1-message_container" class="shiny-html-output"></div>
<div id="quiz-deff-1-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
<section id="the-effective-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="the-effective-sample-size">The effective sample size</h3>
<p>Another way to quantify the impact of overdispersion is through the <em>effective sample size</em>, <span class="math inline">\(N_{\text{eff}}\)</span>. The effective sample size tells us how many perfectly independent samples would be needed in order to achieve the same level of statistical efficiency as present in our design. In other words, it tells us how large our study would need to be if we could get rid of overdispersion completely. We calculate <span class="math inline">\(N_{\text{eff}}\)</span> by dividing the true total sample size by the design effect:</p>
<p><span class="math display">\[
N_{\text{eff}} = \frac{\sum_{i=1}^c n_i}{D_{\text{eff}}}
\]</span></p>
<p>Complete the following R code to calculate an effective sample size:</p>
<div class="cell" data-exercise="true" data-exercise.setup="neff-params">
<div class="tutorial-exercise" data-label="neff-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate effective sample size based on total sample size and design effect</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>N_eff <span class="ot">&lt;-</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(N_eff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="neff-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate effective sample size based on total sample size and design effect</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>N_eff <span class="ot">&lt;-</span> <span class="fu">sum</span>(n) <span class="sc">/</span> D_eff</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(N_eff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(N_{\text{eff}} = 56.7\)</span>.</p>
</details>
<p><br></p>
<p>Our effective sample size is just 56.7, despite a total sample size of 725. This means that enrolling only 57 patients through true random sampling from the population would have provided the same amount of information as our multi-cluster study with 725 participants. However, this doesn’t imply that a simple random sampling approach would have been better—such an approach would likely have been less feasible and more expensive. Instead, the concept of effective sample size gives us a clearer understanding of how overdispersion leads to a loss of information, helping us better account for its impact in multi-cluster studies.</p>
</section>
<section id="the-intra-cluster-correlation-coefficient" class="level3">
<h3 class="anchored" data-anchor-id="the-intra-cluster-correlation-coefficient">The intra-cluster correlation coefficient</h3>
<p>The third and final measure that we will consider is the <em>intra-cluster correlation coefficient</em> (ICC), denoted <span class="math inline">\(r\)</span>. This is a measure between 0 and 1 that describes how correlated observations are <em>within</em> a cluster (site). If there is correlation with clusters then there <em>must</em> be overdispersion between clusters, and likewise if there is overdispersion then there <em>must</em> be intra-cluster correlation greater than 0.</p>
<p>The relationship between the ICC and the design effect is:</p>
<p><span class="math display">\[
D_{\text{eff}} = 1 + r(\bar{n} - 1)
\]</span> where <span class="math inline">\(\bar{n}\)</span> is the mean sample size over sites. Notice that when <span class="math inline">\(r\)</span> is zero the design effect equals 1, indicating that our study is as statistically efficient as simple random sampling. The larger the value of <span class="math inline">\(r\)</span>, the higher the design effect and the more inefficient our design.</p>
<p>We can flip this equation around to give us the ICC as a function of the design effect:</p>
<p><span class="math display">\[
r = \frac{D_{\text{eff}} - 1}{\bar{n} - 1}
\]</span></p>
<p>Complete the following R code to calculate the value of the ICC from the design effect that we estimated above:</p>
<div class="cell" data-exercise="true" data-exercise.setup="neff-params">
<div class="tutorial-exercise" data-label="ICC-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean sample size</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>n_bar <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ICC</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ICC <span class="ot">&lt;-</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ICC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="ICC-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean sample size</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>n_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(n)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ICC</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ICC <span class="ot">&lt;-</span> (D_eff <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n_bar <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ICC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(r = 0.132\)</span>.</p>
</details>
<p><br></p>
<p>The ICC can be harder to interpret than other measures like the design effect or effective sample size, but it does have certain advantages. We can think of the ICC as an <em>intrinsic</em> property of the population, while the design effect is only a measure of the inefficiency of <em>our study</em>. While <span class="math inline">\(D_{\text{eff}}\)</span> is influenced by <span class="math inline">\(r\)</span>, it is also influenced by many other factors, most notably the sample size. If we were to double the sample size of a study then our design effect would change, but the ICC would stay exactly the same. This makes it more straightforward to compare values of <span class="math inline">\(r\)</span> between studies, while we have to take great care when comparing values of <span class="math inline">\(D_{\text{eff}}\)</span>.</p>
</section>
</section>
<section id="accounting-for-overdispersion-in-analysis" class="level2">
<h2 class="anchored" data-anchor-id="accounting-for-overdispersion-in-analysis">Accounting for overdispersion in analysis</h2>
<p>We have seen what overdispersion looks like in prevalence data, and how it can be quantified. Now we will learn how to incorporate overdispersion into our design and analysis phases.</p>
<section id="overdispersion-and-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="overdispersion-and-confidence-intervals">Overdispersion and confidence intervals</h3>
<p>Let’s look again at the <em>pfhrp2/3</em> data from Dodoma region:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confirmed Malaria<br>
(n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2/3 Deleted<br>
(x)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2/3 Deletion Prevalence<br>
(p)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Chalinze</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Ibwaga</td>
<td style="text-align: right; width: 3cm;">80</td>
<td style="text-align: right; width: 3cm;">12</td>
<td style="text-align: right; width: 4cm;">0.150</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Lukali</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Malolo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">26</td>
<td style="text-align: right; width: 4cm;">0.260</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Mafene</td>
<td style="text-align: right; width: 3cm;">95</td>
<td style="text-align: right; width: 3cm;">25</td>
<td style="text-align: right; width: 4cm;">0.263</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Mpendo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">45</td>
<td style="text-align: right; width: 4cm;">0.450</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Nhinhi</td>
<td style="text-align: right; width: 3cm;">50</td>
<td style="text-align: right; width: 3cm;">0</td>
<td style="text-align: right; width: 4cm;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Rudi</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">11</td>
<td style="text-align: right; width: 4cm;">0.110</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup><br>
Table 2: pfhrp2/3 deletion data broken down by site</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
<p>We already estimated the prevalence in the region as the mean over sites, giving <span class="math inline">\(\hat{p} = 0.172\)</span>. Now we want to construct a 95% CI around this estimate. For this, we need a modified version of the Wald confidence interval:</p>
<p><span class="math display">\[
\hat{p} \pm z_{1 - \alpha/2}\sqrt{\frac{\hat{p}(1 - \hat{p})}{N} D_{\text{eff}}}
\]</span> Here, <span class="math inline">\(N\)</span> is the total sample size summed over all sites, which in our case is <span class="math inline">\(N = 725\)</span>. The main difference from our previous version of the Wald confidence interval is the inclusion of the design effect, <span class="math inline">\(D_{\text{eff}}\)</span>. Notice that <span class="math inline">\(D_{\text{eff}}\)</span> <em>stretches</em> the interval, meaning a higher design effect would lead to greater uncertainty.</p>
<p>Complete the following R code to calculate a 95% CI on the global prevalence using this new version of the Wald formula. Note that you still have access to previously computed variables in this code box, including <code>n</code>, <code>x</code>, <code>p</code>, <code>p_global</code> and <code>D_eff</code>:</p>
<div class="cell" data-exercise="true" data-exercise.setup="wald-params">
<div class="tutorial-exercise" data-label="Wald-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get total sample size and z</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate margin of error</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate lower and upper limits</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(CI_lower, CI_upper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="Wald-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get total sample size and z</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">sum</span>(n)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate margin of error</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(p_global<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> N <span class="sc">*</span> D_eff)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate lower and upper limits</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> p_global <span class="sc">-</span> m</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> p_global <span class="sc">+</span> m</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(CI_lower, CI_upper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that the CI ranges from 0.073 to 0.270, or in other words from 7.3% to 27.0%.</p>
</details>
<p><br></p>
<p>This CI is considerably wider than we would have obtained if we did not take overdispersion into account. The two confidence intervals are shown below:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="activity5_multicluster_interactive_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>If we ignored overdispersion and assumed all observations were independent, we would risk overestimating the precision of our global prevalence estimate, leading to unwarranted over-confidence in its accuracy.</p>
</section>
<section id="overdispersion-and-hypothesis-testing" class="level3">
<h3 class="anchored" data-anchor-id="overdispersion-and-hypothesis-testing">Overdispersion and hypothesis testing</h3>
<p>Similarly, when it comes to hypothesis testing, we have to factor overdispersion into our analysis. For example, imagine we want to compare our global estimate of the prevalence of <em>pfhrp2/3</em> deletions against a defined threshold of 10%. The appropriate statistical test here is the one-sample z-test for proportions, which we covered in an earlier module. However, we need to use a new formula for the test statistic (<span class="math inline">\(Z\)</span>) that factors in the design effect:</p>
<p><span class="math display">\[
Z = \frac{\hat{p} - p_0}{\sqrt{\frac{\hat{p}(1 - \hat{p})}{N}D_{\text{eff}}}}
\]</span> Where <span class="math inline">\(p_0\)</span> is the threshold we are comparing against.</p>
<p>This can be calculated in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define threshold</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate test statistic</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> (p_global <span class="sc">-</span> p0) <span class="sc">/</span> <span class="fu">sqrt</span>(p_global <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> N <span class="sc">*</span> D_eff)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.430108</code></pre>
</div>
</div>
<p>We obtain a test statistic of <span class="math inline">\(Z = 1.43\)</span>. This does not exceed the critical values at <span class="math inline">\(\pm1.96\)</span>, meaning we would fail to reject the null hypothesis. However, if we were to run the same analysis but ignoring the design effect, we would find <span class="math inline">\(Z = 5.11\)</span>. This is highly significant, and would result in us rejecting the null hypothesis. This is an example where overdispersion is critically important, as it dictates the result of our hypothesis test! For something like a <em>pfhrp2/3</em> study, this could mean the difference between switching RDTs nationwide vs.&nbsp;sticking with the current brand of tests.</p>
<p><strong>Disclaimer: We do not advocate for the use of the z-test for the design of pfhrp2/3 deletion studies, or the analysis of the resulting data. We will learn about a much more powerful approach to this problem in the next module.</strong></p>
</section>
</section>
<section id="accounting-for-overdispersion-in-design" class="level2">
<h2 class="anchored" data-anchor-id="accounting-for-overdispersion-in-design">Accounting for overdispersion in design</h2>
<section id="overdispersion-and-power" class="level3">
<h3 class="anchored" data-anchor-id="overdispersion-and-power">Overdispersion and power</h3>
<p>Addressing overdispersion is just as critical in the design stage as it is in the analysis stage. For the one-sample z-test for proportions, we already saw the formula for power in a previous module. Now, we obtain a new formula that takes <span class="math inline">\(D_{\text{eff}}\)</span> into account:</p>
<p><span class="math display">\[
\text{Power} = 1 - \phi\left(z_{1-\alpha/2} - \frac{|p - p_0|}{\sqrt{\frac{p(1-p)}{N}}D_{\text{eff}}} \right)
\]</span> To make use of this formula, we have to assume known values for the true global prevalence <span class="math inline">\(p\)</span> and also the design effect <span class="math inline">\(D_{\text{eff}}\)</span>. We also have to set the total sample size <span class="math inline">\(N\)</span> and the threshold <span class="math inline">\(p_0\)</span>. We will assume <span class="math inline">\(p = 0.2\)</span>, <span class="math inline">\(D_{\text{eff}} = 10\)</span>, <span class="math inline">\(N = 800\)</span> and <span class="math inline">\(p_0 = 0.1\)</span>.</p>
<p>We can calculate the power under this new formula in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define assumed parameters</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>D_eff <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">800</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define z-values</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected value of test statistic</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>E_Z <span class="ot">&lt;-</span> <span class="fu">abs</span>(p <span class="sc">-</span> p0) <span class="sc">/</span> <span class="fu">sqrt</span>(p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">/</span> N <span class="sc">*</span> D_eff)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate power</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z_alpha <span class="sc">-</span> E_Z)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6087521</code></pre>
</div>
</div>
<p>Under this study design we only have 61% power. Contrast this with power of 99.99998% that we obtain if we ignore the design effect! Clearly the inclusion of the design effect is severely hurting our power in this analysis, however, it is better to include the design effect and be realistic than to ignore the design effect and obtain results that are unreliable.</p>
</section>
<section id="overdispersion-and-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="overdispersion-and-sample-size">Overdispersion and sample size</h3>
<p>When it comes to the formula for minimum sample size under the z-test, we cannot assume a known value of the design effect. This is because the design effect itself depends on the sample size, so our reasoning becomes circular. However, in our equation for sample size we can assume a known value of the ICC as this is an intrinsic propertly of the population.</p>
<p>Our new minimum sample size formula becomes:</p>
<p><span class="math display">\[
n = \frac{1 - r}{\frac{c(p - p_0)^2}{(z_{1 - \alpha/2} + z_{1 - \beta})^2 p(1-p)} - r}
\]</span></p>
<p>Note that <span class="math inline">\(n\)</span> is the sample size <em>per cluster</em>, assuming there are <span class="math inline">\(c\)</span> clusters of equal size. We can calculate this in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define assumed parameters</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span>        <span class="co"># prevalence of deletions</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.1</span>        <span class="co"># threshold to compare against</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.05</span>       <span class="co"># intra-cluster correlation</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">8</span>          <span class="co"># number of clusters</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define z-values</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>z_beta <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.8</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate minimum sample size</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> r) <span class="sc">/</span> (c<span class="sc">*</span>(p <span class="sc">-</span> p0)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> ((z_alpha <span class="sc">+</span> z_beta)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">-</span> r)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69.33436</code></pre>
</div>
</div>
<p>Based on this analysis we would need 8 clusters of 70 samples. Compare this with the 8 clusters of just 16 samples we would need if we ignored intra-cluster correlation. Again, if we ignore this effect then we risk running a study that is too small, and ultimately does not have power to detect a real effect.</p>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
# options(repos = c(
#   plasmogenepi = "https://plasmogenepi.r-universe.dev",
#   CRAN = "https://cloud.r-project.org"
# ))

library(learnr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(DRpower)
knitr::opts_chunk$set(warning = FALSE,
                      echo = FALSE)

# needed for longer calculations (eg DRpower) note - in seconds
tutorial_options(exercise.timelimit = 120)

set.seed(3)

# mock up pfhrp2/3 deletion data
dat <- data.frame(Site = c("Chalinze", "Ibwaga", "Lukali", "Malolo", "Mafene", "Mpendo", "Nhinhi", "Rudi")) |>
  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),
         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),
         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))

# save variables
n <- dat$Confirmed_malaria
x <- dat$pfhrp2_deleted
p <- dat$prevalence
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::prepare_tutorial_state(session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::i18n_observe_tutorial_language(input, session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::event_trigger(session, "session_stop")
      })
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sandbox-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sandbox-1-code-editor`)), session)
output$`tutorial-exercise-sandbox-1-output` <- renderUI({
  `tutorial-exercise-sandbox-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sandbox-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "sandbox-1", code = "# you can access the following vectors\nprint(n)\nprint(x)\nprint(p)", 
        opts = list(label = "\"sandbox-1\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "sandbox-1", exercise = TRUE, 
        original.params.src = "r sandbox-1, exercise=TRUE", chunk.echo = FALSE, 
        code = c("# you can access the following vectors", "print(n)", 
        "print(x)", "print(p)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r sandbox-1, exercise=TRUE", fig.num = 0, 
        exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-global-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-global-1-code-editor`)), session)
output$`tutorial-exercise-global-1-output` <- renderUI({
  `tutorial-exercise-global-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "global-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "global-1", code = "# calculate p_global as mean prevalence over sites\np_global <- \n\nprint(p_global)", 
        opts = list(label = "\"global-1\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("# calculate p_global as mean prevalence over sites", 
    "p_global <- mean(p)", "", "print(p_global)"), chunk_opts = list(
        label = "global-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "global-1", exercise = TRUE, 
        original.params.src = "r global-1, exercise=TRUE", chunk.echo = FALSE, 
        code = c("# calculate p_global as mean prevalence over sites", 
        "p_global <- ", "", "print(p_global)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r global-1, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-global-2-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-global-2-code-editor`)), session)
output$`tutorial-exercise-global-2-output` <- renderUI({
  `tutorial-exercise-global-2-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "global-2", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "global-2", code = "# calculate p_global as weighted mean prevalence over sites\np_global <- \n\nprint(p_global)", 
        opts = list(label = "\"global-2\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("# calculate p_global as weighted mean prevalence over sites", 
    "p_global <- sum(x) / sum(n)", "", "print(p_global)"), chunk_opts = list(
        label = "global-2-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "global-2", exercise = TRUE, 
        original.params.src = "r global-2, exercise=TRUE", chunk.echo = FALSE, 
        code = c("# calculate p_global as weighted mean prevalence over sites", 
        "p_global <- ", "", "print(p_global)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r global-2, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-1-1", 
    question = structure("How many sites have a prevalence outside the expected 95% interval?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_e8ff70b", 
        option = "0", value = "0", label = structure("0", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_2b982af", 
        option = "2", value = "2", label = structure("2", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_5615868", 
        option = "4", value = "4", label = structure("4", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_9445895", 
        option = "6", value = "6", label = structure("6", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! There are six sites that have prevalence either above or below the 95% confidence interval.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: a site-level prevalence is outside the range if it is either above the upper error bar, or below the lower error bar.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: a site-level prevalence is outside the range if it is either above the upper error bar, or below the lower error bar.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-1-1-answer", question = "quiz-overdispersion-1-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1955147601.08956, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-1-2", 
    question = structure("From this plot, does the prevalence appear to be over-dispersed, under-dispersed, or neither?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_78a5222", 
        option = "Over-dispersed", value = "Over-dispersed", 
        label = structure("Over-dispersed", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_d0ec53a", 
        option = "Under-dispersed", value = "Under-dispersed", 
        label = structure("Under-dispersed", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_1ab9295", 
        option = "Neither", value = "Neither", label = structure("Neither", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! The presence of this many sites outside the expected range is unlikely to happen by chance, and is an indication of overdispersion.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: ‘dispersion’ describes the spread of data. Is there more or less spread than we would expect?.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: ‘dispersion’ describes the spread of data. Is there more or less spread than we would expect?.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-1-2-answer", question = "quiz-overdispersion-1-2"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 2051554594.04467, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_checkbox", label = "quiz-overdispersion-1-3", 
    question = structure("What could cause this overdispersion? Select all correct responses.", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_d6af8c4", 
        option = "Limited migration and gene flow between sites.", 
        value = "Limited migration and gene flow between sites.", 
        label = structure("Limited migration and gene flow between sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_a2e0e75", 
        option = "Variation in treatment practices leading to different selective pressures between sites.", 
        value = "Variation in treatment practices leading to different selective pressures between sites.", 
        label = structure("Variation in treatment practices leading to different selective pressures between sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_d457f49", 
        option = "Local outbreaks within sites, driven by infected individuals carrying *pfhrp2/3* deletions.", 
        value = "Local outbreaks within sites, driven by infected individuals carrying *pfhrp2/3* deletions.", 
        label = structure("Local outbreaks within sites, driven by infected individuals carrying <em>pfhrp⅔<\u002fem> deletions.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A wide range of factors can lead to overdispersion, meaning it is extremely common in multi-cluster studies.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect. Be sure to select every correct answer.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: that is one explanation, but is it the only possible explanation?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-1-3-answer", question = "quiz-overdispersion-1-3"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 671201705.687447, options = list()), class = c("learnr_checkbox", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-1-4", 
    question = structure("Why does the Nhinhi site have a slightly wider 95% interval than the other sites?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_53382d3", 
        option = "The Nhinhi site has higher prevalence of *pfhrp2/3* deletions.", 
        value = "The Nhinhi site has higher prevalence of *pfhrp2/3* deletions.", 
        label = structure("The Nhinhi site has higher prevalence of <em>pfhrp⅔<\u002fem> deletions.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_b783ae7", 
        option = "The diagnostic methods used at the Nhinhi site are less accurate.", 
        value = "The diagnostic methods used at the Nhinhi site are less accurate.", 
        label = structure("The diagnostic methods used at the Nhinhi site are less accurate.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_99e403f", 
        option = "The Nhinhi site is geographically isolated.", 
        value = "The Nhinhi site is geographically isolated.", 
        label = structure("The Nhinhi site is geographically isolated.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_6b86b17", 
        option = "The sample size in Nhinhi is lower than other sites.", 
        value = "The sample size in Nhinhi is lower than other sites.", 
        label = structure("The sample size in Nhinhi is lower than other sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A smaller sample size will lead to a wider 95% interval.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: look at the formula for the 95% interval. Which factor in the formula means it will vary between sites?", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: look at the formula for the 95% interval. Which factor in the formula means it will vary between sites?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-1-4-answer", question = "quiz-overdispersion-1-4"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1850218984.13842, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-deff-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-deff-1-code-editor`)), session)
output$`tutorial-exercise-deff-1-output` <- renderUI({
  `tutorial-exercise-deff-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "deff-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)", 
    chunks = list(list(label = "deff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)", 
        opts = list(label = "\"deff-params\""), engine = "r"), 
        list(label = "deff-1", code = "# calculate design effect from the variances\nD_eff <- \n\nprint(D_eff)", 
            opts = list(label = "\"deff-1\"", exercise = "TRUE", 
                exercise.setup = "\"deff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate design effect from the variances", 
    "D_eff <- var_observed / var_SRS", "", "print(D_eff)"), chunk_opts = list(
        label = "deff-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "deff-1", exercise = TRUE, 
        exercise.setup = "deff-params", original.params.src = "r deff-1, exercise=TRUE, exercise.setup = \"deff-params\"", 
        chunk.echo = FALSE, code = c("# calculate design effect from the variances", 
        "D_eff <- ", "", "print(D_eff)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r deff-1, exercise=TRUE, exercise.setup = \"deff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_checkbox", label = "quiz-deff-1-1", 
    question = structure("A high value of the design effect means we can expect to see (check all correct responses):", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_e361ca8", 
        option = "Less precise estimates of the global prevalence $\\hat{p}$", 
        value = "Less precise estimates of the global prevalence $\\hat{p}$", 
        label = structure("Less precise estimates of the global prevalence \\(\\hat{p}\\)", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_700bd28", 
        option = "Lower power", value = "Lower power", label = structure("Lower power", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_c125479", 
        option = "Larger sample sizes needed", value = "Larger sample sizes needed", 
        label = structure("Larger sample sizes needed", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A high design effect means we have a statistically inefficient design, which will impact our precision, power, and sample size.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect. Be sure to select every correct answer.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: that is a correct response, but is it the only correct response?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-deff-1-1-answer", question = "quiz-deff-1-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 345934799.838912, options = list()), class = c("learnr_checkbox", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-neff-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-neff-1-code-editor`)), session)
output$`tutorial-exercise-neff-1-output` <- renderUI({
  `tutorial-exercise-neff-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "neff-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
    chunks = list(list(label = "neff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
        opts = list(label = "\"neff-params\""), engine = "r"), 
        list(label = "neff-1", code = "# calculate effective sample size based on total sample size and design effect\nN_eff <- \n\nprint(N_eff)", 
            opts = list(label = "\"neff-1\"", exercise = "TRUE", 
                exercise.setup = "\"neff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate effective sample size based on total sample size and design effect", 
    "N_eff <- sum(n) / D_eff", "", "print(N_eff)"), chunk_opts = list(
        label = "neff-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "neff-1", exercise = TRUE, 
        exercise.setup = "neff-params", original.params.src = "r neff-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        chunk.echo = FALSE, code = c("# calculate effective sample size based on total sample size and design effect", 
        "N_eff <- ", "", "print(N_eff)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r neff-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-ICC-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-ICC-1-code-editor`)), session)
output$`tutorial-exercise-ICC-1-output` <- renderUI({
  `tutorial-exercise-ICC-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "ICC-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
    chunks = list(list(label = "neff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
        opts = list(label = "\"neff-params\""), engine = "r"), 
        list(label = "ICC-1", code = "# calculate the mean sample size\nn_bar <- \n\n# calculate the ICC\nICC <- \n\nprint(ICC)", 
            opts = list(label = "\"ICC-1\"", exercise = "TRUE", 
                exercise.setup = "\"neff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate the mean sample size", 
    "n_bar <- mean(n)", "", "# calculate the ICC", "ICC <- (D_eff - 1) / (n_bar - 1)", 
    "", "print(ICC)"), chunk_opts = list(label = "ICC-1-solution")), 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "ICC-1", exercise = TRUE, 
        exercise.setup = "neff-params", original.params.src = "r ICC-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        chunk.echo = FALSE, code = c("# calculate the mean sample size", 
        "n_bar <- ", "", "# calculate the ICC", "ICC <- ", "", 
        "print(ICC)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r ICC-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-Wald-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-Wald-1-code-editor`)), session)
output$`tutorial-exercise-Wald-1-output` <- renderUI({
  `tutorial-exercise-Wald-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "Wald-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2/3 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
    chunks = list(list(label = "wald-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nD_eff <- var_observed / var_SRS", 
        opts = list(label = "\"wald-params\""), engine = "r"), 
        list(label = "Wald-1", code = "# get total sample size and z\nN <- \nz <- 1.96\n\n# calculate margin of error\nm <- \n\n# calculate lower and upper limits\nCI_lower <- \nCI_upper <- \n\nprint(c(CI_lower, CI_upper))", 
            opts = list(label = "\"Wald-1\"", exercise = "TRUE", 
                exercise.setup = "\"wald-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# get total sample size and z", 
    "N <- sum(n)", "z <- 1.96", "", "# calculate margin of error", 
    "m <- 1.96*sqrt(p_global*(1 - p_global) / N * D_eff)", "", 
    "# calculate lower and upper limits", "CI_lower <- p_global - m", 
    "CI_upper <- p_global + m", "", "print(c(CI_lower, CI_upper))"
    ), chunk_opts = list(label = "Wald-1-solution")), tests = NULL, 
    options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "activity5_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity5_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "Wald-1", exercise = TRUE, 
        exercise.setup = "wald-params", original.params.src = "r Wald-1, exercise=TRUE, exercise.setup = \"wald-params\"", 
        chunk.echo = FALSE, code = c("# get total sample size and z", 
        "N <- ", "z <- 1.96", "", "# calculate margin of error", 
        "m <- ", "", "# calculate lower and upper limits", "CI_lower <- ", 
        "CI_upper <- ", "", "print(c(CI_lower, CI_upper))"), 
        out.width.px = 672L, out.height.px = 480L, params.src = "r Wald-1, exercise=TRUE, exercise.setup = \"wald-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(
    function(q, nm, val) {
      # Infer name, if possible
      if (nm == "") {
        tryCatch(
          {
            nm <- rlang::as_name(q)
          },
          error = function(e) {
            code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
            stop(
              "ojs_define() could not create a name for the argument: ",
              code
            )
          }
        )
      }
      .session$output[[nm]] <- val
      outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
      .session$sendCustomMessage("ojs-export", list(name = nm))
      NULL
    },
    quos,
    nm,
    vars,
    SIMPLIFY = FALSE,
    USE.NAMES = FALSE
  )
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["6.4.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.min.css","css/v4-shims.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fontawesome"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["5.5.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.11.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.4.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.4.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.4.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.4.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73]}},"value":[{"type":"character","attributes":{},"value":["backports","base","checkmate","cli","commonmark","compiler","datasets","dichromat","digest","dplyr","DRpower","ellipsis","evaluate","extraDistr","farver","fastmap","fontawesome","generics","ggplot2","glue","graphics","grDevices","grid","gtable","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","kableExtra","knitr","knitrProgressBar","labeling","later","learnr","lifecycle","magrittr","markdown","methods","mime","pillar","pkgconfig","promises","purrr","R.methodsS3","R.oo","R6","RColorBrewer","Rcpp","rlang","rmarkdown","rprojroot","rstudioapi","S7","scales","shiny","stats","stringi","stringr","svglite","systemfonts","tibble","tidyr","tidyselect","tools","utils","vctrs","viridisLite","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.5.0","4.4.0","2.3.1","3.6.5","1.9.1","4.4.0","4.4.0","2.0-0.1","0.6.37","1.1.4","1.0.4","0.3.2","0.24.0","1.10.0","2.1.2","1.2.0","0.5.2","0.1.4","4.0.0","1.8.0","4.4.0","4.4.0","4.4.0","0.3.6","0.5.8.1","1.6.4","1.6.15","0.1.4","2.0.0","1.4.0","1.47","1.1.0","0.4.3","1.3.2","0.11.5","1.0.4","2.0.4","1.13","4.4.0","0.12","1.11.1","2.0.3","1.3.0","1.1.0","1.8.2","1.26.0","2.6.1","1.1-3","1.0.13","1.1.6","2.27","2.1.1","0.16.0","0.2.0","1.4.0","1.8.1.1","4.4.0","1.8.7","1.5.2","2.1.3","1.1.0","3.3.0","1.3.1","1.2.1","4.4.0","4.4.0","0.6.5","0.4.2","3.0.2","0.45","1.3.6","1.8-4","2.3.9"]}]}]}
</script>
<!--/html_preserve-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>