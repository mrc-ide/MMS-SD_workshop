<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-11-10">

<title>Malaria Molecular Surveillance Study Design workshop - Activity 3: Hypothesis Testing and Power</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Malaria Molecular Surveillance Study Design workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target=""><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html" rel="" target=""><i class="bi bi-calendar" role="img">
</i> 
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lectures.html" rel="" target=""><i class="bi bi-bookmark" role="img">
</i> 
 <span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../../tutorials.html" rel="" target="">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module2_MOE_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/module6/module6_scenarios.html" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 6</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link active" data-scroll-target="#learning-outcomes">Learning outcomes</a></li>
  <li><a href="#short-quiz-on-hypothesis-testing-and-power" id="toc-short-quiz-on-hypothesis-testing-and-power" class="nav-link" data-scroll-target="#short-quiz-on-hypothesis-testing-and-power">Short quiz on hypothesis testing and power</a></li>
  <li><a href="#testing-for-changes-in-drug-resistance-prevalence-over-time" id="toc-testing-for-changes-in-drug-resistance-prevalence-over-time" class="nav-link" data-scroll-target="#testing-for-changes-in-drug-resistance-prevalence-over-time">Testing for changes in drug resistance prevalence over time</a></li>
  <li><a href="#detecting-rare-variants" id="toc-detecting-rare-variants" class="nav-link" data-scroll-target="#detecting-rare-variants">Detecting rare variants</a></li>
  <li><a href="#bonus-questions" id="toc-bonus-questions" class="nav-link" data-scroll-target="#bonus-questions">Bonus questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Activity 3: Hypothesis Testing and Power</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="learning-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="learning-outcomes">Learning outcomes</h2>
<p>This activity focuses on hypothesis testing and power. After a short quiz, you will work through two examples; 1) detecting a change in prevalence over time, and 2) looking to detect rare variants. In this activity you will learn:</p>
<ul>
<li>Some key definitions around null hypothesis testing.</li>
<li>How to use a test statistic to decide whether or not to reject a null hypothesis.</li>
<li>How to perform power analysis under two different statistical tests, and how to use this to select sample sizes.</li>
<li>How to interpret power curves.</li>
</ul>
<p><em>Disclaimer: The scenarios in this document are entirely fictitious. While real place names are used, the data itself is simulated for teaching purposes only. It does not necessarily represent the real epidemiological situation.</em></p>
</section>
<section id="short-quiz-on-hypothesis-testing-and-power" class="level2">
<h2 class="anchored" data-anchor-id="short-quiz-on-hypothesis-testing-and-power">Short quiz on hypothesis testing and power</h2>
<p><strong>Question:</strong> What is a null hypothesis?</p>
<p><strong>Options:</strong></p>
<ul>
<li>A statement that there is a significant effect or difference between groups.</li>
<li>A prediction about the future outcome of an experiment.</li>
<li>A statement that there is no effect or no difference between groups, and any observed effect is due to chance. <strong>(correct)</strong></li>
<li>A hypothesis that describes the expected relationship between two variables.</li>
</ul>
<p><strong>Question:</strong> Which of these is <em>not</em> a null hypothesis?</p>
<p><strong>Options:</strong></p>
<ul>
<li>There is no difference in malaria prevalence between people who sleep under bed-nets and people who do not.</li>
<li>The presence of a genetic marker for drug resistance is independent of the region (e.g., East Africa vs.&nbsp;West Africa).</li>
<li>Elevation has no linear relationship with malaria risk.</li>
<li>Malaria incidence is twice as high in men as it is in women. <strong>(correct)</strong></li>
</ul>
<p><strong>Question:</strong> A false-negative result is when…(this one takes some thinking)</p>
<p><strong>Options:</strong></p>
<ul>
<li><ol type="A">
<li>You fail to reject the null hypothesis when it is actually false. <strong>(correct)</strong></li>
</ol></li>
<li><ol start="2" type="A">
<li>You fail to reject the null hypothesis when it is actually true.</li>
</ol></li>
<li><ol start="3" type="A">
<li>You reject the null hypothesis when it is actually false.</li>
</ol></li>
<li><ol start="4" type="A">
<li>You reject the null hypothesis when it is actually true.</li>
</ol></li>
</ul>
<p><strong>Answer:</strong> This type of question is always tricky as the language is all quite similar. Remember that a “negative” result means we <em>fail to reject</em> the null hypothesis. We were looking for something interesting, we didn’t find it, so we stick with the null. This means we can narrow down the answer to A) or B). Now consider that the question was about a “false-negative”, meaning we came to the incorrect conclusion. This means the null hypothesis must have actually been false, and we made the wrong choice by failing to reject it. Therefore, the answer is A).</p>
<p><strong>Question:</strong> The parameter <span class="math inline">\(\alpha\)</span> is often referred to as…</p>
<p><strong>Options:</strong></p>
<ul>
<li>The confidence level of a hypothesis test.</li>
<li>The significance level of a hypothesis test. <strong>(correct)</strong></li>
<li>The power of a statistical test.</li>
<li>The probability of making a Type II error.</li>
</ul>
<p><strong>Question:</strong> The value of <span class="math inline">\(\alpha\)</span> defines…</p>
<p><strong>Options:</strong></p>
<ul>
<li>The sample size of our study.</li>
<li>The chance of getting a false-negative result (also known as a Type II error).</li>
<li>The strength of the effect we observe.</li>
<li>The chance of getting a false-positive result (also known as a Type I error). <strong>(correct)</strong></li>
</ul>
<p><strong>Question:</strong> A statistical test that only examines effects in one direction, not both, is called…</p>
<p><strong>Options:</strong></p>
<ul>
<li>A one-headed test.</li>
<li>A one-way street analysis.</li>
<li>A wild goose chase.</li>
<li>A one-tailed test.<strong>(correct)</strong></li>
</ul>
<p><strong>Question:</strong> TRUE or FALSE, in statistical testing, we always compare our test statistic against the same distribution.</p>
<p><strong>Options:</strong></p>
<ul>
<li>TRUE</li>
<li>FALSE <strong>(correct)</strong></li>
</ul>
<p><strong>Question:</strong> You are running a study to test if the prevalence of a drug resistant mutation has changed over time. You will analyse your data using a z-test. The critical values for a two-tailed z-test at the significance level <span class="math inline">\(\alpha = 0.05\)</span> are at <span class="math inline">\(\pm1.96\)</span>. You obtain a test statistic of -2.54. What should you do based on this result?</p>
<p><strong>Options:</strong></p>
<ul>
<li>Reject the null hypothesis because the test statistic is less than zero.</li>
<li>Reject the null hypothesis because the test statistic exceeds the lower critical value. <strong>(correct)</strong></li>
<li>Fail to reject the null hypothesis because the test statistic is negative.</li>
<li>Fail to reject the null hypothesis because the test statistic is less than the upper critical value.</li>
</ul>
<p><strong>Answer:</strong>. We should reject the null hypothesis because we exceed the critical values. In this example, we have two critical values, one negative value at -1.96 and one positive value at +1.96. Anything inside this region (greater than -1/96 but less than +1.96) is reasonably likely under the null hypothesis, but values outside this region are unlikely. Our value was outside this region, meaning we should reject the null hypothesis.</p>
</section>
<section id="testing-for-changes-in-drug-resistance-prevalence-over-time" class="level2">
<h2 class="anchored" data-anchor-id="testing-for-changes-in-drug-resistance-prevalence-over-time">Testing for changes in drug resistance prevalence over time</h2>
<p>You are concerned that the prevalence of antimalarial resistance might be increasing in your region. You have data on the prevalence of <em>pfmdr1</em> N86Y mutations from a cross-sectional survey that took place three years ago. You plan to repeat the survey to establish if there has been a change in the prevalence of N86Y mutations over this time. The statistical test you plan to use is a z-test for proportions.</p>
<p><strong>Question:</strong> Which of these is the null hypothesis under this test?</p>
<p><strong>Options:</strong></p>
<ul>
<li>The prevalence of <em>pfmdr1</em> N86Y mutations has increased over the past three years.</li>
<li>The prevalence of <em>pfmdr1</em> N86Y mutations has decreased over the past three years.</li>
<li>The prevalence of <em>pfmdr1</em> N86Y mutations is the same now as it was three years ago. <strong>correct</strong></li>
<li>The prevalence of <em>pfmdr1</em> N86Y mutations differs between now and three years ago.</li>
</ul>
<p>The study three years ago obtained genetic data from 80 samples, of which 12 were identified as carrying the N86Y mutation. We can estimate the prevalence as: <span class="math display">\[
p_1 = \frac{12}{80} = 0.15
\]</span> As part of our power analysis, we have to assume a known value of the prevalence at the present day. We will be pessimistic and assume that the prevalence has doubled over the three years to <span class="math inline">\(p_2=0.30\)</span>.</p>
<p>We know that the sample size was <span class="math inline">\(n_1=80\)</span> for the first study. For the present study we plan to use a larger sample size of <span class="math inline">\(n_2=300\)</span>.</p>
<p>Given all of these values, we can calculate the expected value for our test statistic using the following formula: <span class="math display">\[
\mu_{\text{alt}} = \frac{|p_1 - p_2|}{\sqrt{\frac{p_1(1-p_1)}{n_1} + \frac{p_2(1-p_2)}{n_2}}}
\]</span> Note that the vertical lines around <span class="math inline">\(|p_1 - p2|\)</span> mean we should take the <em>absolute value</em> of the difference in prevalence. This ensures that <span class="math inline">\(\mu_{\text{alt}}\)</span> is always positive.</p>
<p>Complete the following R code to calculate the value of <span class="math inline">\(\mu_{\text{alt}}\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate absolute value of difference in prevalence</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>p_diff <span class="ot">&lt;-</span> <span class="fu">abs</span>(p1 <span class="sc">-</span> p2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the standard error</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p1<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p1) <span class="sc">/</span> n1 <span class="sc">+</span> p2<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p2) <span class="sc">/</span> n2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mu_alt</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>mu_alt <span class="ot">&lt;-</span> p_diff <span class="sc">/</span> SE</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mu_alt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.131975</code></pre>
</div>
</div>
<p>We can use the value of <span class="math inline">\(\mu_{\text{alt}}\)</span> to tell us our power. The formula for power under the z-test is:</p>
<p><span class="math display">\[
P_{ow} = 1 - \phi(z_{1-\alpha/2} - \mu_{\text{alt}})
\]</span></p>
<p>In this formula, <span class="math inline">\(\phi(x)\)</span> refers to the area under the curve of a standard normal distribution from <span class="math inline">\(-\infty\)</span> up to the point <span class="math inline">\(x\)</span>. There is no simple way of calculating this value, but we can obtain it easily in R using the <code>pnorm()</code> function. As in previous activities, the value <span class="math inline">\(z_{1 - \alpha/2}\)</span> refers to the critical value of the normal distribution at a significance level <span class="math inline">\(\alpha\)</span> (two-tailed), which is approximately equal to 1.96.</p>
<p>Complete the following R code to calculate the power under the planned study design:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define significance level and calculate z</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate power</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z <span class="sc">-</span> mu_alt)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8794036</code></pre>
</div>
</div>
<p>From this calculation, we can see that our power is around 88%.</p>
<p><strong>Question:</strong> A power of 88% means…</p>
<p><strong>Options:</strong></p>
<ul>
<li>There is an 88% chance that the study will be successful.</li>
<li>There is an 88% difference in prevalence between the time points.</li>
<li>There is an 88% chance that the alternative hypothesis is true.</li>
<li>Assuming the alternative hypothesis is true, there is an 88% chance that we will correctly reject the null hypothesis. <strong>correct</strong></li>
</ul>
<p>We normally aim for 80% power, meaning this study design is adequately powered. In fact, we could argue that this study is slightly <em>over-powered</em>, meaning we could get away with using fewer samples and still be good enough.</p>
<p>The following power curve shows us the power as a function of the sample size (<span class="math inline">\(n_2\)</span>). The region with 80% power or above is shaded in blue.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="activity3_power_static_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p><strong>Question:</strong> From this graph, what sample size is needed to achieve a power of 80%?</p>
<p><strong>Options:</strong></p>
<ul>
<li>140</li>
<li>165 <strong>correct</strong></li>
<li>190</li>
<li>285</li>
</ul>
<p>Only 165 samples are needed for us to obtain 80% power. From the power curve, we can see that we reach diminishing returns as we continue increasing the sample size, meaning there is little benefit to continually driving up the sample size. The conclusion of our power analysis is that our initial plan to sequence 300 samples was excessive, and we can get away with sequencing far fewer samples. This is likely to lead to cost savings, and may allow us to redirect these resources elsewhere.</p>
</section>
<section id="detecting-rare-variants" class="level2">
<h2 class="anchored" data-anchor-id="detecting-rare-variants">Detecting rare variants</h2>
<p>You are planning a study to look for the presence of validated <em>pfk13</em> mutations. You are not interested in estimating the prevalence of mutations, rather you want to know if any of these mutations are <em>present</em> in your population. You will test people for malaria as they present to a local health facility, and a subset of dried blood spots from malaria-positive patients will be sent away for sequencing. You only have the resources to sequence 100 samples, and you want to know if it is worth conducting a study with such a small sample size.</p>
<p>This type of presence-absence study can be framed as a hypothesis test. The null hypothesis is that <em>there are no validated mutations present in the population</em>, i.e.&nbsp;the prevalence of these mutations is zero. Even a single observation of a mutation would disprove this null hypothesis, therefore - unlike most statistical tests (e.g.&nbsp;the z-test above) - there is no test statistic to calculate here. Instead, we simply reject the null hypothesis if we see a single validated mutant, otherwise we fail to reject the null hypothesis.</p>
<p>We start by assuming a known prevalence, <span class="math inline">\(p\)</span>, for the validated mutations. We also need to define our sample size, <span class="math inline">\(n\)</span>. Samples are assumed to be drawn at random from the population.</p>
<p>The probability that a single sample is negative for mutants is <span class="math inline">\(1-p\)</span>. The probability that all <span class="math inline">\(n\)</span> samples are negative is <span class="math inline">\((1 - p)^n\)</span>. The probability of seeing at least one mutant is one minus the probability of seeing no mutants. The probability of seeing at least one mutant is also defined as our power under this test, therefore:</p>
<p><span class="math display">\[
P_{ow} = 1 - (1 - p)^n
\]</span></p>
<p>Complete the following R code to calculate the power under an assumed prevalence of <span class="math inline">\(p=0.05\)</span> and a sample size of <span class="math inline">\(n=100\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define parameters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate power</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> p)<span class="sc">^</span>n</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9940795</code></pre>
</div>
</div>
<p>We have extremely high power under this example, which is reassuring.</p>
<p><strong>Question:</strong> What is the power if we assume the prevalence of validated mutants is only 1% in the population?</p>
<p><strong>Options:</strong></p>
<ul>
<li>51%</li>
<li>63% <strong>correct</strong></li>
<li>76%</li>
<li>84%</li>
</ul>
<p>The following power curves show power as a function of sample size for a range of different value of <span class="math inline">\(p\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="activity3_power_static_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p><strong>Question:</strong> From these power curves, what sample size is needed to achieve 80% power if we assume the true prevalence of mutants in the population is 2%?</p>
<p><strong>Options:</strong></p>
<ul>
<li>40</li>
<li>60</li>
<li>80 <strong>correct</strong></li>
<li>90</li>
</ul>
<p><strong>Question:</strong> What about if we assume the prevalence is 1%?</p>
<p><strong>Options:</strong></p>
<ul>
<li>16</li>
<li>32</li>
<li>80</li>
<li>More than 100, meaning we cannot achieve 80% power within our resource limits.<strong>correct</strong></li>
</ul>
<p>Our original question was whether it was worth conducting this study given our tight resource constraints of at most 100 samples sequenced. What the graph shows us is that whether or not it is worth running this study depends on what we are happy to assume about the prevalence of mutations in the population. If we are very worried about missing mutations present at only 1% in the population, then it is not worth running this study (unless we have some other indirect benefits of the sequencing) as we will be under-powered. On the other hand, if we would not be very concerned about mutations at 1% prevalence, and we are much more concerned about them reaching 5% prevalence or higher, then we would achieve adequate power with as few as 32 samples. This is the point at which statistical information needs to be combined with clinical and programmatic information to make an informed decision about the most appropriate course of action.</p>
</section>
<section id="bonus-questions" class="level2">
<h2 class="anchored" data-anchor-id="bonus-questions">Bonus questions</h2>
<p>A study was conducted with the aim of detecting rare <em>pfk13</em> variants. A sample size of 32 was used, as this was determined to be sufficient based on statistical arguments. However, during sequencing it also became clear that <em>pfmdr1</em> mutations could be sequenced from the same samples at little extra cost. 10 out of the 32 samples were found to carry the <em>pfmdr1</em> N86Y mutation, giving a prevalence of 32%. This was surprising - only last year a study had found a prevalence of 20% in a sample of 150 people. This raised the question of whether the prevalence of N86Y mutations had increased significantly over this period.</p>
<p>The research team carried out a z-test for proportions to see if there was a statistically significant increase between the two studies. Here are the inputs to their test:</p>
<p><span class="math display">\[
\begin{align}
\hat{p}_1 &amp;= \frac{30}{150} = 0.20 \\
\hat{p}_2 &amp;= \frac{10}{32} = 0.31 \\
\hat{p} &amp;= \frac{30 + 10}{150 + 32} = 0.22 \\
n_1 &amp;= 150 \\
n_2 &amp;= 32
\end{align}
\]</span> The test statistic was calculated from these values as follows: <span class="math display">\[
Z = \frac{|\hat{p}_1 - \hat{p}_2|}{\sqrt{\hat{p}(1 - \hat{p})\left(\frac{1}{n_1} + \frac{1}{n_2}\right)}}
\]</span></p>
<p>This gives the value <span class="math inline">\(Z = 1.40\)</span>. The researchers compared this value against the critical values of <span class="math inline">\(\pm1.96\)</span> and found that this was non-significant. Therefore, they did not have evidence to reject the null hypothesis that prevalence stayed the same over this time period. They took this as reassurance that prevalence of N86Y mutations is not increasing in the region.</p>
<p>However…</p>
<p><strong>Question:</strong> Were they right to come to this conclusion? What was their power to detect a a change in prevalence from 20% to 30%? What about a change from 20% to 40%? How does this “retrospective” power analysis change how we interpret the non-significant finding from the z-test?</p>
<p><strong>Answer:</strong></p>
<p>When we conduct power analysis under the z-test, we find that power to detect a change from 20% to 30% was only around 21%. Similarly, power to detect a change from 20% to 40% was still only 58%. This falls well below the usual 80% power threshold. With this low power there would be a very good chance of getting a non-significant result even if prevalence had doubled!</p>
<p>The problem here is that the sample size of 32 is too small, leading to an underpowered study. This happened because the study design was not powered to answer questions about the change in prevalence of N86Y mutations, rather it was designed and powered to answer a question about presence/absence of rare <em>pfk13</em> variants.</p>
<p>The lack of power means we shouldn’t read too much into the non-significant finding. There could have been major changes in the prevalence of N86Y mutations over the year, but we would have very little chance of rejecting the null hypothesis due to our lack of power.</p>
<p><strong>Question:</strong> How could this low power have been avoided?</p>
<p><strong>Answer:</strong> If our plan was to look for changes in prevalence of N86Y mutations alongside looking for rare <em>pfk13</em> mutants then this should have been accounted for at the design stage. A power analysis should have been conducted that took into account <em>both endpoints</em>. This would have resulted in a larger sample size that was sufficient to answer both questions.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>