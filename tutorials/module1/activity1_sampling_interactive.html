<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Activity 1: Sampling from a population – Malaria Molecular Surveillance Study Design workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8b20df304ae43519df5d458fcc8598a6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Malaria Molecular Surveillance Study Design workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-events" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-calendar" role="img">
</i> 
 <span class="menu-text">Events</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-events">    
        <li>
    <a class="dropdown-item" href="../../events.html">
 <span class="dropdown-text">Events overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../workshop2024.html">
 <span class="dropdown-text">2024 New Orleans Workshop</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../workshop2025.html">
 <span class="dropdown-text">2025 Toronto workshop (upcoming)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../lectures.html"> <i class="bi bi-bookmark" role="img">
</i> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../../tutorials.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity1_sampling_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 1 - Sampling from a population</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity2_MOE_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 2 - Sample size calculation based on margin of error</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity3_hypothesis_testing_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 3 - Hypothesis testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity4_power_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 4 - Statistical power</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity5_multicluster_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 5 - Dealing with overdispersion in multi-cluster studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/activity6_DRpower_interactive/"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 6 - The DRpower tool</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/module7/module7_scenarios.html"><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Activity 7 - Designing a study for multiple end-points</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  </ul></li>
  <li><a href="#what-is-my-population" id="toc-what-is-my-population" class="nav-link" data-scroll-target="#what-is-my-population">What is my population?</a></li>
  <li><a href="#relating-the-sample-to-the-population" id="toc-relating-the-sample-to-the-population" class="nav-link" data-scroll-target="#relating-the-sample-to-the-population">Relating the sample to the population</a>
  <ul class="collapse">
  <li><a href="#using-the-population-census" id="toc-using-the-population-census" class="nav-link" data-scroll-target="#using-the-population-census">Using the population census</a></li>
  <li><a href="#population-demographics" id="toc-population-demographics" class="nav-link" data-scroll-target="#population-demographics">Population demographics</a></li>
  <li><a href="#sampling-from-the-population" id="toc-sampling-from-the-population" class="nav-link" data-scroll-target="#sampling-from-the-population">Sampling from the population</a></li>
  <li><a href="#sampling-many-times-from-the-population" id="toc-sampling-many-times-from-the-population" class="nav-link" data-scroll-target="#sampling-many-times-from-the-population">Sampling many times from the population</a></li>
  <li><a href="#bonus-question" id="toc-bonus-question" class="nav-link" data-scroll-target="#bonus-question">✨ BONUS QUESTION ✨</a></li>
  </ul></li>
  <li><a href="#estimating-prevalence-in-our-sample-and-calculating-the-95-confidence-interval" id="toc-estimating-prevalence-in-our-sample-and-calculating-the-95-confidence-interval" class="nav-link" data-scroll-target="#estimating-prevalence-in-our-sample-and-calculating-the-95-confidence-interval">Estimating prevalence in our sample and calculating the 95% confidence interval</a>
  <ul class="collapse">
  <li><a href="#estimating-prevalence-in-our-sample" id="toc-estimating-prevalence-in-our-sample" class="nav-link" data-scroll-target="#estimating-prevalence-in-our-sample">Estimating prevalence in our sample</a></li>
  <li><a href="#what-is-the-estimated-prevalence-of-malaria-in-our-sample" id="toc-what-is-the-estimated-prevalence-of-malaria-in-our-sample" class="nav-link" data-scroll-target="#what-is-the-estimated-prevalence-of-malaria-in-our-sample">What is the estimated prevalence of malaria in our sample?</a></li>
  <li><a href="#calculating-the-95-ci" id="toc-calculating-the-95-ci" class="nav-link" data-scroll-target="#calculating-the-95-ci">Calculating the 95% CI</a></li>
  </ul></li>
  <li><a href="#comparing-to-the-true-prevalence" id="toc-comparing-to-the-true-prevalence" class="nav-link" data-scroll-target="#comparing-to-the-true-prevalence">Comparing to the true prevalence</a></li>
  <li><a href="#how-often-does-true-prevalence-fall-within-the-95ci" id="toc-how-often-does-true-prevalence-fall-within-the-95ci" class="nav-link" data-scroll-target="#how-often-does-true-prevalence-fall-within-the-95ci">How often does true prevalence fall within the 95%CI?</a>
  <ul class="collapse">
  <li><a href="#bonus-questions" id="toc-bonus-questions" class="nav-link" data-scroll-target="#bonus-questions">✨ BONUS QUESTIONS ✨</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Activity 1: Sampling from a population</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to Activity 1: <strong>Sampling from a population</strong>.</p>
<p>In this module, we’ll explore how to relate samples to populations, calculate confidence intervals, and understand the impact of sample size on study results. To introduce these statistical concepts, we’ll start with a simple example focused on determining the prevalence of malaria. This approach provides a gentle introduction to thinking about these ideas in the context of study design. These same concepts are directly applicable to malaria molecular surveillance (MMS) studies. For instance, in MMS studies, we might design our research to estimate the prevalence of molecular markers, such as drug resistance markers, rather than the prevalence of malaria infection itself.</p>
<section id="learning-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h3>
<p>By the end of this tutorial, you will be able to:</p>
<ul>
<li>Define the target population for a study.</li>
<li>Explain the difference between a population and a sample.</li>
<li>Calculate a 95% confidence interval.</li>
<li>Assess how sampling variability impacts our estimate of the population.</li>
<li>Understand the effect of sample size on confidence intervals.</li>
</ul>
</section>
</section>
<section id="what-is-my-population" class="level2">
<h2 class="anchored" data-anchor-id="what-is-my-population">What is my population?</h2>
<p>In any study, clearly defining the <strong>target population</strong> is crucial. Let’s consider a few examples of made-up studies.</p>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Target population</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-study-pop-1" class="tutorial-question panel-body">
<div id="quiz-study-pop-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-study-pop-1-message_container" class="shiny-html-output"></div>
<div id="quiz-study-pop-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
<section id="relating-the-sample-to-the-population" class="level2">
<h2 class="anchored" data-anchor-id="relating-the-sample-to-the-population">Relating the sample to the population</h2>
<p>Sampling the entire population is often impractical, whether due to cost constraints or the challenges of reaching everyone. Fortunately, we can design our study to ensure that the sample we collect is a <strong>representative subset</strong> of the population.</p>
<p>When designing epidemiological studies, various data sources can offer valuable insights into the population. Examples include Demographic and Health Surveys (DHS) or population censuses, which provide comprehensive information to help guide study design.</p>
<section id="using-the-population-census" class="level3">
<h3 class="anchored" data-anchor-id="using-the-population-census">Using the population census</h3>
<p>Let’s go back to our made-up study.</p>
<p>We now have access to a census of the entire population of the village (N = 10000) with information on each resident’s age and sex. For purposes of this tutorial, imagine there are 2678 people in the village with malaria infections and we know the true infection status of every individual. This will help us understand how our sample relates to the entire population.</p>
<p>This is the information we have in the census (here we show the first 6 residents in the census):</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">malaria_infection</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Not infected</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">79</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Not infected</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Infected</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Not infected</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Not infected</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">37</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Infected</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="population-demographics" class="level3">
<h3 class="anchored" data-anchor-id="population-demographics">Population demographics</h3>
<p>Below we can see a breakdown of malaria-infected individuals in this population.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="activity1_sampling_interactive_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s look at the age and sex distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="activity1_sampling_interactive_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sampling-from-the-population" class="level3">
<h3 class="anchored" data-anchor-id="sampling-from-the-population">Sampling from the population</h3>
<p>Suppose we have resources to determine the infection status of 200 individuals. Let’s randomly sample 200 individuals from the population and see how they compare with the overall population. We can explore demographic differences by plotting the age and sex distribution of the sample compared with the population.</p>
<p>Below we use the function <code>sampleFromPopulation()</code> and we specify what our sample size is and from where we want to sample (in our case from the census data). We can use the <code>plotAgeSexDistribution()</code> and <code>plotInfectedProportion()</code> functions to visualize our results. Click on “Run Code”.</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sampling-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sampleFromPopulation</span>(<span class="at">sample_size =</span> <span class="dv">200</span>, census)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">compareSampleToPopulation</span>(sample, census)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAgeSexDistribution</span>(comparison)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInfectedProportion</span>(comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Do we see a similar age and sex distribution? What about the proportion of infected and not infected individuals in the population? </span></p>
</div>
</section>
<section id="sampling-many-times-from-the-population" class="level3">
<h3 class="anchored" data-anchor-id="sampling-many-times-from-the-population">Sampling many times from the population</h3>
<p>Now run this a few times by clicking “Run Code” to see how it changes with every random sample.</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sampling-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sampleFromPopulation</span>(<span class="at">sample_size =</span> <span class="dv">200</span>, census)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">compareSampleToPopulation</span>(sample, census)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAgeSexDistribution</span>(comparison)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInfectedProportion</span>(comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Sampling from the population</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sampling-1" class="tutorial-question panel-body">
<div id="quiz-sampling-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-sampling-1-message_container" class="shiny-html-output"></div>
<div id="quiz-sampling-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sampling-2" class="tutorial-question panel-body">
<div id="quiz-sampling-2-answer_container" class="shiny-html-output"></div>
<div id="quiz-sampling-2-message_container" class="shiny-html-output"></div>
<div id="quiz-sampling-2-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Smaller sample sizes are more susceptible to sampling variability. With a smaller number of individuals there is an increased chance the sample will deviate from the population characteristics. Think about how this may impact your results. </span></p>
</div>
</section>
<section id="bonus-question" class="level3">
<h3 class="anchored" data-anchor-id="bonus-question">✨ BONUS QUESTION ✨</h3>
<p>You will have noticed from our exploration above that the sample differs from the population and it doesn’t always have the same age and sex distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Sampling bias</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sampling-bias-1" class="tutorial-question panel-body">
<div id="quiz-sampling-bias-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-sampling-bias-1-message_container" class="shiny-html-output"></div>
<div id="quiz-sampling-bias-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="estimating-prevalence-in-our-sample-and-calculating-the-95-confidence-interval" class="level2">
<h2 class="anchored" data-anchor-id="estimating-prevalence-in-our-sample-and-calculating-the-95-confidence-interval">Estimating prevalence in our sample and calculating the 95% confidence interval</h2>
<p>Our next topic focuses on calculating the 95% confidence interval (CI) on the prevalence. The 95% CI provides an interval with defined lower and upper bounds, representing the range within which we are 95% confident the true population prevalence lies. In other words, if we were to repeat the sampling process many times and calculate a confidence interval for each sample, approximately 95 out of 100 of these intervals would contain the true population prevalence.</p>
<section id="estimating-prevalence-in-our-sample" class="level3">
<h3 class="anchored" data-anchor-id="estimating-prevalence-in-our-sample">Estimating prevalence in our sample</h3>
<p>For this exercise we have already pre-calculated some useful parameters:</p>
<ul>
<li>Defined <code>sample_size</code> to be 200</li>
<li>Defined <code>infected_count</code> to be the number of infected individuals in our sample (in our example it is 69 individuals)</li>
<li>Defined the function <code>sampleFromPopulation()</code> to select 200 individuals at random from our census</li>
</ul>
</section>
<section id="what-is-the-estimated-prevalence-of-malaria-in-our-sample" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-estimated-prevalence-of-malaria-in-our-sample">What is the estimated prevalence of malaria in our sample?</h3>
<p>We can calculate this by dividing the number of individuals infected with malaria by our sample size.</p>
<p>Try coding it yourself, or click on the solution. <em>Note: In R when we want to divide two things we can use <code>/</code>.</em></p>
<div class="cell" data-exercise="true" data-exercise.setup="sample-seed-params">
<div class="tutorial-exercise" data-label="est-prev" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="est-prev-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate from the raw values</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dv">69</span> <span class="sc">/</span> <span class="dv">200</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or you can use the stored variables:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>infected_count <span class="sc">/</span> sample_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer</p>
</summary>
<p>Our estimated prevalence is 0.345 or 34.5%.</p>
</details></section>
<section id="calculating-the-95-ci" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-95-ci">Calculating the 95% CI</h3>
<p>Next, we need to calculate the 95% CI around our point estimate.</p>
<p>Below is the formula for the <strong>Wald confidence interval:</strong></p>
<p><span class="math display">\[
CI = \hat{p} \pm z_{1 - \alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}
\]</span> Where:</p>
<ul>
<li><span class="math inline">\(\hat{p}\)</span> = sample proportion (i.e.&nbsp;estimated prevalence)</li>
<li><span class="math inline">\({n}\)</span> = sample size</li>
<li><span class="math inline">\(\ z_{1 - \alpha/2}\)</span> = critical value of the normal distribution at significance level <span class="math inline">\(\alpha\)</span> (two sided)</li>
</ul>
<p>We will now go through this formula step-by-step!</p>
<section id="defining-our-sample-proportion-hatp" class="level4">
<h4 class="anchored" data-anchor-id="defining-our-sample-proportion-hatp">1. Defining our sample proportion, <span class="math inline">\(\hat{p}\)</span></h4>
<p>The sample proportion refers to the proportion of infected individuals in our sample. We calculated this above by dividing the number of infected individuals in the sample by the total sample size.</p>
<p>Complete the code below to calculate this value and record it as <code>p_hat</code>.</p>
<div class="cell" data-exercise="true" data-exercise.setup="sample-seed-params">
<div class="tutorial-exercise" data-label="phat" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="phat-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample proportion</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> infected_count <span class="sc">/</span> sample_size</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>p_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<section id="sample-size-n" class="level5">
<h5 class="anchored" data-anchor-id="sample-size-n">2. Sample size, <span class="math inline">\(n\)</span></h5>
<p>Above, we defined our sample size to be n=200. We already recorded this in the variable <code>sample_size</code>, so you don’t need to do anything extra.</p>
</section>
<section id="calculating-the-standard-error" class="level5">
<h5 class="anchored" data-anchor-id="calculating-the-standard-error">3. Calculating the standard error</h5>
<p>We can calculate the standard error using <code>p_hat</code> and <code>sample_size</code>. We can calculate the standard error using:</p>
<p><span class="math display">\[
SE = \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}
\]</span> Complete the code below to calculate standard error and store it in the variable <code>SE</code>:</p>
<p><em>Note: In R the function to take the square root is <code>sqrt()</code> and when we want to multiply two things we can use <code>*</code>.</em></p>
<div class="cell" data-exercise="true" data-exercise.setup="sample-seed-params">
<div class="tutorial-exercise" data-label="SE" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="SE-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard error</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((p_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_hat)) <span class="sc">/</span> sample_size)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>SE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer</p>
</summary>
<p>Our standard error is 0.034.</p>
</details></section>
<section id="calculating-the-confidence-interval" class="level5">
<h5 class="anchored" data-anchor-id="calculating-the-confidence-interval">4. Calculating the confidence interval</h5>
<p>Now that we know our standard error, we can calculate the lower and upper bounds of our 95% confidence interval (CI). To do this, we multiply the standard error by <span class="math inline">\(z_{1-\alpha/2}\)</span> , which is approximately 1.96 for a 95% CI. This factor is derived from the normal distribution, where 95% of the probability lies within 1.96 standard deviations of the mean.</p>
<p>Complete the code below to calculate the lower bound from <code>z_alpha</code> and your stored value of <code>SE</code>. Look back at the formula for the Wald interval above if you’re stuck.</p>
<div class="cell" data-exercise="true" data-exercise.setup="sample-seed-params">
<div class="tutorial-exercise" data-label="ci-lower" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Critical value for 95% confidence</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower bound</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="ci-lower-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Critical value for 95% confidence</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower bound</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>p_hat <span class="sc">-</span> z_alpha <span class="sc">*</span> SE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer</p>
</summary>
<p>Our lower bound is 0.279 or 27.9%.</p>
</details>
<p>Now let’s calculate the upper bound. Remember now we need to <em>add</em> instead of subtract.</p>
<div class="cell" data-exercise="true" data-exercise.setup="sample-seed-params">
<div class="tutorial-exercise" data-label="ci-upper" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Critical value for 95% confidence</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Upper bound</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="ci-upper-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Critical value for 95% confidence</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Upper bound</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>p_hat <span class="sc">+</span> z_alpha <span class="sc">*</span> SE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer</p>
</summary>
Our upper bound is 0.411 or 41.1%.
</details>
</section>
<section id="putting-it-all-together" class="level5">
<h5 class="anchored" data-anchor-id="putting-it-all-together">5. Putting it all together</h5>
<p>Let’s put all the steps above together!</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="ci-calculation" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input observed data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>infected_count <span class="ot">&lt;-</span> <span class="dv">69</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the sample proportion and standard error</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> infected_count <span class="sc">/</span> sample_size</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((p_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_hat)) <span class="sc">/</span> sample_size)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate lower and upper 95% bounds</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> p_hat <span class="sc">-</span> z_alpha <span class="sc">*</span> SE</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> p_hat <span class="sc">+</span> z_alpha <span class="sc">*</span> SE</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print our values</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>p_hat</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>CI_lower</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>CI_upper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<p>So, putting it all together, our estimated prevalence is 34.5% and our 95% CI is 27.9% to 41.1%.</p>
</section>
</section>
</section>
</section>
<section id="comparing-to-the-true-prevalence" class="level2">
<h2 class="anchored" data-anchor-id="comparing-to-the-true-prevalence">Comparing to the true prevalence</h2>
<p>You may remember from the census data that <strong>26.78%</strong> of our population was infected with malaria. This is the <em>true</em> prevalence.</p>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - 95% confidence interval</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-ci-prev-1" class="tutorial-question panel-body">
<div id="quiz-ci-prev-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-ci-prev-1-message_container" class="shiny-html-output"></div>
<div id="quiz-ci-prev-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Do you always expect the true prevalence to fall within the 95%CI? </span></p>
</div>
</section>
<section id="how-often-does-true-prevalence-fall-within-the-95ci" class="level2">
<h2 class="anchored" data-anchor-id="how-often-does-true-prevalence-fall-within-the-95ci">How often does true prevalence fall within the 95%CI?</h2>
<p>We explored above what would happen if we randomly sampled 200 individuals. In our example, the true prevalence didn’t fall within the 95% CI. But this was just one example. Now we want to see what happens if we repeat this sampling <em>many</em> times. Let’s now explore by running a simulation where we sample 1000 times and we will count how many times our true prevalence is within the 95%CI.</p>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Before you run the below code, think about the intuition behind this - how often do you expect the true prevalence to be within the 95%CI? </span></p>
</div>
<p>Now run the code and see if you were correct!</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sim-ci" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, <span class="fu">simulate_CI</span>(census, sample_size, true_prevalence))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCISimulationResults</span>(results, n_simulations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title">QUIZ - Confidence Intervals and Simulation</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sim-ci-1" class="tutorial-question panel-body">
<div id="quiz-sim-ci-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-1-message_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sim-ci-2" class="tutorial-question panel-body">
<div id="quiz-sim-ci-2-answer_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-2-message_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-2-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-sim-ci-3" class="tutorial-question panel-body">
<div id="quiz-sim-ci-3-answer_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-3-message_container" class="shiny-html-output"></div>
<div id="quiz-sim-ci-3-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<p>After running the simulation, you should notice that the true prevalence falls within the 95% confidence intervals in approximately <strong>95% of the simulations</strong>. This outcome aligns with the definition of a 95% confidence interval: if we were to repeat the sampling process many times, we would expect the true parameter to lie within the calculated confidence interval about 95 out of 100 times.</p>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> This simulation demonstrates the concept of confidence level in statistical inference. It shows that the method we use to calculate confidence intervals is reliable in the long run. However, in any single sample (like the one we initially took), there’s still a chance (about 5%) that the true prevalence will not be captured within the interval. This is why it’s important to interpret confidence intervals correctly and understand that they provide a measure of the uncertainty associated with our estimates. </span></p>
</div>
<section id="bonus-questions" class="level3">
<h3 class="anchored" data-anchor-id="bonus-questions">✨ BONUS QUESTIONS ✨</h3>
<p><em>Note: This section is optional and requires more coding than the previous exercise</em></p>
<p>Let’s repeat this exercise for a sample size of 500. Try coding it yourself from scratch using the functions that we used above. Click on the solution if you get stuck!</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sampling-500" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">500</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="sampling-500-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">sampleFromPopulation</span>(sample_size, census)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">compareSampleToPopulation</span>(sample_data, census)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAgeSexDistribution</span>(comparison)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInfectedProportion</span>(comparison)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>infected_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(sample_data<span class="sc">$</span>malaria_infection <span class="sc">==</span> <span class="st">"Infected"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> infected_count <span class="sc">/</span> sample_size</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((p_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_hat)) <span class="sc">/</span> sample_size)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> p_hat <span class="sc">-</span> Z <span class="sc">*</span> SE</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> p_hat <span class="sc">+</span> Z <span class="sc">*</span> SE</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">checkPrevalenceCI</span>(true_prevalence, CI_lower, CI_upper)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, <span class="fu">simulate_CI</span>(census, sample_size, true_prevalence))</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCISimulationResults</span>(results, n_simulations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div style="padding: 10px; border-radius: 5px; background-color: #fef3e7;">
<p><span style="font-size: 1.2em; color: #d19554;"> <i class="fas fa-comment"></i> Reflection: </span></p>
<p><span style="color:#d19554;"> Is there a greater chance of the true prevalence being within the 95% CI with this larger sample? If not, why not? </span></p>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
# options(repos = c(
#   plasmogenepi = "https://plasmogenepi.r-universe.dev",
#   CRAN = "https://cloud.r-project.org"
# ))

library(learnr)
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
# library(DRpower)

knitr::opts_chunk$set(warning = FALSE,
                      echo = FALSE)

# needed for longer calculations (eg DRpower) note - in seconds
tutorial_options(exercise.timelimit = 120)

# FUNCTIONS
sampleFromPopulation <- function(sample_size, census){
  ss <- sample_size
  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement 
  
  return(sample_data)
}

compareSampleToPopulation <- function(sample, census){
  comparison <- bind_rows(
    census %>% mutate(group = "Population") %>% select(age, sex, malaria_infection, group),
    sample %>% mutate(group = "Sample") %>% select(age, sex, malaria_infection, group))
  
  return(comparison)
}

plotAgeSexDistribution <- function(comparison){
  comparison %>% 
  ggplot(aes(x = age, fill = sex)) +
    geom_histogram(binwidth = 5, color = "white", boundary = 0) +
    scale_fill_brewer(palette = "Set2") +
    labs(title = "Age and sex distribution", x = "Age (years)", y = "Count") +
    theme_minimal() +
    facet_wrap(~group, scales = "free_y")
}

plotInfectedProportion <- function(comparison){
  comparison %>% 
    count(group, malaria_infection) %>% 
    group_by(group) %>% 
    mutate(proportion = n/sum(n)) %>% 
    ungroup() %>% 
    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +
      geom_bar(stat = "identity") +
      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), 
                color = "white",
                position = position_stack(vjust = 0.5),
                size = 4,
                show.legend = F) +
      scale_fill_brewer(palette = "Set1",
                        name = NULL) +
      scale_color_brewer(palette = "Set1") +
      scale_y_continuous(labels = scales::percent) +
      labs(title = "Malaria infection status", x = "", y = "") +
      theme_minimal()
}

checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){
  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){
    print(paste0("The true prevalence (", round(true_prevalence*100, 2),"%) falls within the 95%CI (", round(CI_lower*100, 2),"- ", round(CI_upper*100, 2), "%)"))
  }
  else {
    print(paste0("The true prevalence (", round(true_prevalence*100, 2),"%) does not fall within the 95%CI (", round(CI_lower*100, 2),"- ", round(CI_upper*100, 2), "%)"))
  }
}

simulate_CI <- function(census, sample_size, true_prevalence) {
  sample_data <- census %>% sample_n(sample_size, replace = F)
  infected_count <- sum(sample_data$malaria_infection == "Infected")
  p_hat <- infected_count / sample_size
  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)
  CI_lower <- p_hat - Z * SE
  CI_upper <- p_hat + Z * SE
  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)
}

plotCISimulationResults <- function(results, n_simulations){
  results_df <- data.frame(result = results) %>% 
                mutate(result = case_when(result == FALSE ~ "Not within 95%CI",
                                          result == TRUE ~ "Within 95%CI"))
  
  results_df %>% 
  count(result) %>% 
  mutate(proportion = n/sum(n)) %>% 
  ggplot(aes(x = "", y = proportion, fill = result)) +
    geom_bar(stat = "identity",
             position = "fill",
             width = 0.5) +
    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),
                  color = result), 
            position = position_fill(vjust = 0.9), 
            size = 4,
            show.legend = F) +
    scale_fill_manual(values = c("Not within 95%CI" = "grey", "Within 95%CI" = "magenta4"),
                      name = NULL) +
    scale_color_manual(values = c("Not within 95%CI" = "grey30", "Within 95%CI" = "white"),
                      name = NULL) +
    scale_y_continuous(labels = scales::percent) +
    labs(title = paste0("Simulation results (N=", n_simulations, " simulations)"), x = "", y = "") +
    coord_flip() +
    theme_minimal() +
    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())
}

# PRE-LOADED DATA

# fake census data
# N <- 10000
# 
# set.seed(1234)
# 
# census <- data.frame(
#   id = 1:N,
#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?
#   sex = sample(c("Male", "Female"), N, replace = TRUE) #,
#   # malaria_infection = sample(c("Infected", "Not infected"), N, replace = TRUE, prob = c(0.3, 0.7)
# )
# 
# census <- census %>% 
#   # infection probability higher in children
#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,
#                                     age > 14 & age <=44 ~ 0.30,
#                                     age > 44 ~ 0.10,
#                                     TRUE ~ 0.25),
#          malaria_infection = ifelse(runif(n()) <= infection_prob, "Infected", "Not infected")) %>% 
#   select(-infection_prob)
# 
# saveRDS(census, "data/census.rds")

census <- readRDS("data/census.rds")

# GLOBAL PARAMS FOR EXERCISES
true_infected_count <- sum(census$malaria_infection == "Infected")
true_prevalence <- true_infected_count / 10000

# get random sample
# set.seed(5) # to ensure we get the same random sample for our tutorial calculations

# set the sample size
# sample_size <- 200

# sample from the population
# sample_data <- sampleFromPopulation(sample_size, census) 
# saveRDS(sample_data, "tutorials/data/sample_data.rds")

# sample_data <- readRDS("tutorials/data/sample_data.rds")

# Number of infected individuals in the sample
# infected_count <- sum(sample_data$malaria_infection == "Infected")
# 
# p_hat <- infected_count / sample_size
# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)
Z <- 1.96
# CI_lower <- p_hat - Z * SE
# CI_upper <- p_hat + Z * SE
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::prepare_tutorial_state(session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::i18n_observe_tutorial_language(input, session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::event_trigger(session, "session_stop")
      })
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_checkbox", label = "quiz-study-pop-1", 
    question = structure("We want to estimate the prevalence of malaria infection in a community of 10,000 people. Which of the following is the target population?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_533c20c", 
        option = "All residents", value = "All residents", label = structure("All residents", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_35c1457", 
        option = "Only women or only men", value = "Only women or only men", 
        label = structure("Only women or only men", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = structure("If we want to estimate the prevalence in the <em>community<\u002fem> we don’t want to focus only on women or men. <br>", html = TRUE, class = c("html", 
        "character")), type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_bf9cb1f", 
        option = "Only children under 5 years old", value = "Only children under 5 years old", 
        label = structure("Only children under 5 years old", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = structure("If we want to estimate the prevalence in the <em>community<\u002fem> we don’t want to focus only on children. <br>", html = TRUE, class = c("html", 
        "character")), type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_7926516", 
        option = "Adults over 60 years old", value = "Adults over 60 years old", 
        label = structure("Adults over 60 years old", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = structure("If we want to estimate the prevalence in the <em>community<\u002fem> we don’t want to focus on adults. <br>", html = TRUE, class = c("html", 
        "character")), type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! Our target population should be a sample of all the community residents, not a specific demographic or group.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect. Be sure to select every correct answer.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("If we want to estimate the prevalence in the <em>community<\u002fem> we don’t want to focus on a specific demographic or group. <br>", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-study-pop-1-answer", question = "quiz-study-pop-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 866892089.596322, options = list()), class = c("learnr_checkbox", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sampling-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sampling-1-code-editor`)), session)
output$`tutorial-exercise-sampling-1-output` <- renderUI({
  `tutorial-exercise-sampling-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sampling-1", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = NULL, 
    chunks = list(list(label = "sampling-1", code = "sample <- sampleFromPopulation(sample_size = 200, census)\ncomparison <- compareSampleToPopulation(sample, census)\n\nplotAgeSexDistribution(comparison)\n\nplotInfectedProportion(comparison)", 
        opts = list(label = "\"sampling-1\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "sampling-1", exercise = TRUE, 
        original.params.src = "r sampling-1, exercise=TRUE", 
        chunk.echo = FALSE, code = c("sample <- sampleFromPopulation(sample_size = 200, census)", 
        "comparison <- compareSampleToPopulation(sample, census)", 
        "", "plotAgeSexDistribution(comparison)", "", "plotInfectedProportion(comparison)"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r sampling-1, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sampling-2-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sampling-2-code-editor`)), session)
output$`tutorial-exercise-sampling-2-output` <- renderUI({
  `tutorial-exercise-sampling-2-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sampling-2", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = NULL, 
    chunks = list(list(label = "sampling-2", code = "sample <- sampleFromPopulation(sample_size = 200, census)\ncomparison <- compareSampleToPopulation(sample, census)\n\nplotAgeSexDistribution(comparison)\nplotInfectedProportion(comparison)", 
        opts = list(label = "\"sampling-2\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "sampling-2", exercise = TRUE, 
        original.params.src = "r sampling-2, exercise=TRUE", 
        chunk.echo = FALSE, code = c("sample <- sampleFromPopulation(sample_size = 200, census)", 
        "comparison <- compareSampleToPopulation(sample, census)", 
        "", "plotAgeSexDistribution(comparison)", "plotInfectedProportion(comparison)"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r sampling-2, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sampling-1", 
    question = structure("Was the sample always the same?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_4e38e9a", 
        option = "Yes", value = "Yes", label = structure("Yes", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_8aa08ec", 
        option = "No", value = "No", label = structure("No", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! Our sample changes every time we randomly draw a sample from a population.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Are you sure? Try running the code above a few more times. Is it always reflective of the population in terms of age and sex distribution and/or with respect to the proportion of people infected?", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Are you sure? Try running the code above a few more times. Is it always reflective of the population in terms of age and sex distribution and/or with respect to the proportion of people infected?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sampling-1-answer", question = "quiz-sampling-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 288031325.865875, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sampling-2", 
    question = structure("Does our sample of 200 always reflect the population?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_558bbc9", 
        option = "Yes", value = "Yes", label = structure("Yes", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_948d6b6", 
        option = "No", value = "No", label = structure("No", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! When we have small sample sizes this can lead to high uncertainty and more variability thus our sample may not be representative of the population.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Are you sure? Try running the code above a few more times. You could even replace 200 with 50 to see how this impacts the results. Is it always reflective of the population in terms of age and sex distribution and/or with respect to the proportion of people infected? Smaller sample sizes are more susceptible to sampling variability. With a limited number of individuals, the likelihood of the sample deviating from the population characteristics increases.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Are you sure? Try running the code above a few more times. You could even replace 200 with 50 to see how this impacts the results. Is it always reflective of the population in terms of age and sex distribution and/or with respect to the proportion of people infected? Smaller sample sizes are more susceptible to sampling variability. With a limited number of individuals, the likelihood of the sample deviating from the population characteristics increases.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sampling-2-answer", question = "quiz-sampling-2"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 412881415.307737, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sampling-bias-1", 
    question = structure("Does this mean our sampling approach is biased?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_3d963d9", 
        option = "Yes", value = "Yes", label = structure("Yes", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_190bd3f", 
        option = "No", value = "No", label = structure("No", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! The fact that the sample differs from the population does not necessarily mean our sampling approach is biased. Bias refers to a <em>systematic error<\u002fem> that consistently favors certain outcomes. However, because we are randomly sampling 200 individuals with <em>equal chance of being selected<\u002fem> our sampling approach is not biased. This can occur even if the characteristics of our sample (e.g., age and sex distribution) may not perfectly match those of the population.", html = TRUE, class = c("html", 
    "character")), try_again = structure("That is not correct! Although our sample was not always reflective of the population (for example, the characteristics like age and sex distribution did not perfectly match), our <em>sampling<\u002fem> method was unbiased because we randomly sampled 200 individuals and each person had an equal chance of being selected. Bias refers to a <em>systematic error<\u002fem> that consistently favors certain outcomes, which was not the case here.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("That is not correct! Although our sample was not always reflective of the population (for example, the characteristics like age and sex distribution did not perfectly match), our <em>sampling<\u002fem> method was unbiased because we randomly sampled 200 individuals and each person had an equal chance of being selected. Bias refers to a <em>systematic error<\u002fem> that consistently favors certain outcomes, which was not the case here.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sampling-bias-1-answer", question = "quiz-sampling-bias-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 2127900517.50912, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-est-prev-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-est-prev-code-editor`)), session)
output$`tutorial-exercise-est-prev-output` <- renderUI({
  `tutorial-exercise-est-prev-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "est-prev", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
    chunks = list(list(label = "sample-seed-params", code = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
        opts = list(label = "\"sample-seed-params\""), engine = "r"), 
        list(label = "est-prev", code = "", opts = list(label = "\"est-prev\"", 
            exercise = "TRUE", exercise.setup = "\"sample-seed-params\""), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("", "# Calculate from the raw values", 
    "69 / 200", "", "# Or you can use the stored variables:", 
    "infected_count / sample_size"), chunk_opts = list(label = "est-prev-solution")), 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "est-prev", exercise = TRUE, 
        exercise.setup = "sample-seed-params", original.params.src = "r est-prev, exercise = TRUE, exercise.setup = \"sample-seed-params\"", 
        chunk.echo = FALSE, code = "", out.width.px = 672L, out.height.px = 480L, 
        params.src = "r est-prev, exercise = TRUE, exercise.setup = \"sample-seed-params\"", 
        fig.num = 0L, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-phat-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-phat-code-editor`)), session)
output$`tutorial-exercise-phat-output` <- renderUI({
  `tutorial-exercise-phat-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "phat", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
    chunks = list(list(label = "sample-seed-params", code = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
        opts = list(label = "\"sample-seed-params\""), engine = "r"), 
        list(label = "phat", code = "\np_hat <-", opts = list(
            label = "\"phat\"", exercise = "TRUE", exercise.setup = "\"sample-seed-params\""), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("", "# Sample proportion", 
    "p_hat <- infected_count / sample_size", "p_hat"), chunk_opts = list(
        label = "phat-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "phat", exercise = TRUE, 
        exercise.setup = "sample-seed-params", original.params.src = "r phat, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        chunk.echo = FALSE, code = c("", "p_hat <-"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r phat, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-SE-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-SE-code-editor`)), session)
output$`tutorial-exercise-SE-output` <- renderUI({
  `tutorial-exercise-SE-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "SE", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
    chunks = list(list(label = "sample-seed-params", code = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
        opts = list(label = "\"sample-seed-params\""), engine = "r"), 
        list(label = "SE", code = "\nSE <- ", opts = list(label = "\"SE\"", 
            exercise = "TRUE", exercise.setup = "\"sample-seed-params\""), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("", "# Standard error", 
    "SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", "SE"), chunk_opts = list(
        label = "SE-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "SE", exercise = TRUE, 
        exercise.setup = "sample-seed-params", original.params.src = "r SE, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        chunk.echo = FALSE, code = c("", "SE <- "), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r SE, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-ci-lower-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-ci-lower-code-editor`)), session)
output$`tutorial-exercise-ci-lower-output` <- renderUI({
  `tutorial-exercise-ci-lower-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "ci-lower", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
    chunks = list(list(label = "sample-seed-params", code = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
        opts = list(label = "\"sample-seed-params\""), engine = "r"), 
        list(label = "ci-lower", code = "\n# Critical value for 95% confidence\nz_alpha <- 1.96\n\n# Lower bound\n", 
            opts = list(label = "\"ci-lower\"", exercise = "TRUE", 
                exercise.setup = "\"sample-seed-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("", 
    "# Critical value for 95% confidence", "z_alpha <- 1.96", 
    "", "# Lower bound", "p_hat - z_alpha * SE"), chunk_opts = list(
        label = "ci-lower-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "ci-lower", exercise = TRUE, 
        exercise.setup = "sample-seed-params", original.params.src = "r ci-lower, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        chunk.echo = FALSE, code = c("", "# Critical value for 95% confidence", 
        "z_alpha <- 1.96", "", "# Lower bound", ""), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r ci-lower, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-ci-upper-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-ci-upper-code-editor`)), session)
output$`tutorial-exercise-ci-upper-output` <- renderUI({
  `tutorial-exercise-ci-upper-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "ci-upper", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
    chunks = list(list(label = "sample-seed-params", code = "set.seed(5) # to ensure we get the same random sample for our tutorial calculations\n\n# set the sample size\nsample_size <- 200\n\n# sample from the population\nsample_data <- sampleFromPopulation(sample_size, census) \n\n# Count number of infected individuals in the sample\ninfected_count <- sum(sample_data$malaria_infection == \"Infected\")\n\n# p_hat\np_hat <- infected_count/sample_size\n\n# Z\nZ <- 1.96\n\n# SE\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# CI\nCI_lower <- p_hat - Z * SE\nCI_upper <- p_hat + Z * SE", 
        opts = list(label = "\"sample-seed-params\""), engine = "r"), 
        list(label = "ci-upper", code = "\n# Critical value for 95% confidence\nz_alpha <- 1.96\n\n# Upper bound\n", 
            opts = list(label = "\"ci-upper\"", exercise = "TRUE", 
                exercise.setup = "\"sample-seed-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("", 
    "# Critical value for 95% confidence", "z_alpha <- 1.96", 
    "", "# Upper bound", "p_hat + z_alpha * SE"), chunk_opts = list(
        label = "ci-upper-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "ci-upper", exercise = TRUE, 
        exercise.setup = "sample-seed-params", original.params.src = "r ci-upper, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        chunk.echo = FALSE, code = c("", "# Critical value for 95% confidence", 
        "z_alpha <- 1.96", "", "# Upper bound", ""), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r ci-upper, exercise=TRUE, exercise.setup = \"sample-seed-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-ci-calculation-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-ci-calculation-code-editor`)), session)
output$`tutorial-exercise-ci-calculation-output` <- renderUI({
  `tutorial-exercise-ci-calculation-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "ci-calculation", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = NULL, 
    chunks = list(list(label = "ci-calculation", code = "# input observed data\ninfected_count <- 69\nsample_size <- 200\n\n# calculate the sample proportion and standard error\np_hat <- infected_count / sample_size\nSE <- sqrt((p_hat * (1 - p_hat)) / sample_size)\n\n# calculate lower and upper 95% bounds\nz_alpha <- 1.96\nCI_lower <- p_hat - z_alpha * SE\nCI_upper <- p_hat + z_alpha * SE\n\n# Print our values\np_hat\nCI_lower\nCI_upper", 
        opts = list(label = "\"ci-calculation\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "ci-calculation", exercise = TRUE, 
        original.params.src = "r ci-calculation, exercise=TRUE", 
        chunk.echo = FALSE, code = c("# input observed data", 
        "infected_count <- 69", "sample_size <- 200", "", "# calculate the sample proportion and standard error", 
        "p_hat <- infected_count / sample_size", "SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
        "", "# calculate lower and upper 95% bounds", "z_alpha <- 1.96", 
        "CI_lower <- p_hat - z_alpha * SE", "CI_upper <- p_hat + z_alpha * SE", 
        "", "# Print our values", "p_hat", "CI_lower", "CI_upper"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r ci-calculation, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-ci-prev-1", 
    question = structure("Our 95% CI goes from 27.9% to 41.1%. Is our true prevalence within the 95% CI?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_c38c7c4", 
        option = "Yes", value = "Yes", label = structure("Yes", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = structure("The true prevalence (26.78%) is not within the 95%CI of 27.9-41.1%", html = TRUE, class = c("html", 
        "character")), type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_77dd80a", 
        option = "No", value = "No", label = structure("No", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = structure("The true prevalence (26.78%) is not within the 95%CI of 27.9-41.1%. In the next exercise we are going to run some simulations to explore this further.", html = TRUE, class = c("html", 
        "character")), type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("Correct!", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Incorrect", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-ci-prev-1-answer", question = "quiz-ci-prev-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1755276588.68264, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sim-ci-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sim-ci-code-editor`)), session)
output$`tutorial-exercise-sim-ci-output` <- renderUI({
  `tutorial-exercise-sim-ci-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sim-ci", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = NULL, 
    chunks = list(list(label = "sim-ci", code = "n_simulations <- 1000\nsample_size <- 200\n\nresults <- replicate(n_simulations, simulate_CI(census, sample_size, true_prevalence))\n\nplotCISimulationResults(results, n_simulations)", 
        opts = list(label = "\"sim-ci\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "sim-ci", exercise = TRUE, 
        original.params.src = "r sim-ci, exercise=TRUE", chunk.echo = FALSE, 
        code = c("n_simulations <- 1000", "sample_size <- 200", 
        "", "results <- replicate(n_simulations, simulate_CI(census, sample_size, true_prevalence))", 
        "", "plotCISimulationResults(results, n_simulations)"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r sim-ci, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sim-ci-1", 
    question = structure("In the context of confidence intervals, what does a 95% confidence level mean?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_710cb9b", 
        option = "It means that 95% of the time, the sample estimate will be equal to the true population parameter.", 
        value = "It means that 95% of the time, the sample estimate will be equal to the true population parameter.", 
        label = structure("It means that 95% of the time, the sample estimate will be equal to the true population parameter.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_2fb0a5e", 
        option = "It means that 95% of the time the true population parameter will lie within this interval.", 
        value = "It means that 95% of the time the true population parameter will lie within this interval.", 
        label = structure("It means that 95% of the time the true population parameter will lie within this interval.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_43237b", 
        option = "It means that 95% of the data points lie within the confidence interval.", 
        value = "It means that 95% of the data points lie within the confidence interval.", 
        label = structure("It means that 95% of the data points lie within the confidence interval.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_768883b", 
        option = "If we take 100 samples, exactly 95 of them will have intervals containing the true parameter.", 
        value = "If we take 100 samples, exactly 95 of them will have intervals containing the true parameter.", 
        label = structure("If we take 100 samples, exactly 95 of them will have intervals containing the true parameter.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("Correct! A 95% confidence level means we are 95% confident that the true population parameter lies within the interval calculated from our sample.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Not quite. Remember the simulation exercise we undertook above.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Not quite. Remember the simulation exercise we undertook above.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sim-ci-1-answer", question = "quiz-sim-ci-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1773695155.17406, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sim-ci-2", 
    question = structure("After running the simulation of 1,000 samples, approximately how many of the confidence intervals would you expect to contain the true population prevalence?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_8e368b8", 
        option = "About 50 of them.", value = "About 50 of them.", 
        label = structure("About 50 of them.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_ceda673", 
        option = "About 950 of them.", value = "About 950 of them.", 
        label = structure("About 950 of them.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_bb0c979", 
        option = "All 1,000 of them.", value = "All 1,000 of them.", 
        label = structure("All 1,000 of them.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_3f4b638", 
        option = "None of them.", value = "None of them.", label = structure("None of them.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That’s right! With a 95% confidence interval, we’d expect about 950 out of 1,000 intervals to contain the true prevalence.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Consider the definition of a 95% confidence interval—it suggests that approximately 95% of intervals contain the true parameter.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Consider the definition of a 95% confidence interval—it suggests that approximately 95% of intervals contain the true parameter.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sim-ci-2-answer", question = "quiz-sim-ci-2"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1149099047.46491, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-sim-ci-3", 
    question = structure("If the true prevalence falls outside the confidence interval calculated from our sample, does it mean our sampling method is biased?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_255882c", 
        option = "Yes, because the confidence interval should always contain the true parameter.", 
        value = "Yes, because the confidence interval should always contain the true parameter.", 
        label = structure("Yes, because the confidence interval should always contain the true parameter.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_cac3505", 
        option = "No, because even with a correct method, there's still a chance the confidence interval won't contain the true parameter.", 
        value = "No, because even with a correct method, there's still a chance the confidence interval won't contain the true parameter.", 
        label = structure("No, because even with a correct method, there’s still a chance the confidence interval won’t contain the true parameter.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_339946a", 
        option = "Yes, because our sample size was too small.", 
        value = "Yes, because our sample size was too small.", 
        label = structure("Yes, because our sample size was too small.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_702c40e", 
        option = "No, because the confidence interval is only a rough estimate.", 
        value = "No, because the confidence interval is only a rough estimate.", 
        label = structure("No, because the confidence interval is only a rough estimate.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("Exactly! Even with an unbiased sampling method, there’s a 5% chance the true parameter won’t be within the 95% confidence interval.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Not quite. Remember that confidence intervals are calculated with a certain level of confidence, and there’s always a chance the true parameter lies outside the interval.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Not quite. Remember that confidence intervals are calculated with a certain level of confidence, and there’s always a chance the true parameter lies outside the interval.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-sim-ci-3-answer", question = "quiz-sim-ci-3"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1344875015.37374, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sampling-500-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sampling-500-code-editor`)), session)
output$`tutorial-exercise-sampling-500-output` <- renderUI({
  `tutorial-exercise-sampling-500-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sampling-500", global_setup = structure(c("# options(repos = c(", 
"#   plasmogenepi = \"https://plasmogenepi.r-universe.dev\",", 
"#   CRAN = \"https://cloud.r-project.org\"", "# ))", "", "library(learnr)", 
"library(dplyr)", "library(ggplot2)", "library(knitr)", "library(kableExtra)", 
"# library(DRpower)", "", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "# FUNCTIONS", 
"sampleFromPopulation <- function(sample_size, census){", "  ss <- sample_size", 
"  sample_data <- census %>% sample_n(ss, replace = F) # sample without replacement ", 
"  ", "  return(sample_data)", "}", "", "compareSampleToPopulation <- function(sample, census){", 
"  comparison <- bind_rows(", "    census %>% mutate(group = \"Population\") %>% select(age, sex, malaria_infection, group),", 
"    sample %>% mutate(group = \"Sample\") %>% select(age, sex, malaria_infection, group))", 
"  ", "  return(comparison)", "}", "", "plotAgeSexDistribution <- function(comparison){", 
"  comparison %>% ", "  ggplot(aes(x = age, fill = sex)) +", 
"    geom_histogram(binwidth = 5, color = \"white\", boundary = 0) +", 
"    scale_fill_brewer(palette = \"Set2\") +", "    labs(title = \"Age and sex distribution\", x = \"Age (years)\", y = \"Count\") +", 
"    theme_minimal() +", "    facet_wrap(~group, scales = \"free_y\")", 
"}", "", "plotInfectedProportion <- function(comparison){", "  comparison %>% ", 
"    count(group, malaria_infection) %>% ", "    group_by(group) %>% ", 
"    mutate(proportion = n/sum(n)) %>% ", "    ungroup() %>% ", 
"    ggplot(aes(x = group, y = proportion, fill = malaria_infection)) +", 
"      geom_bar(stat = \"identity\") +", "      geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)), ", 
"                color = \"white\",", "                position = position_stack(vjust = 0.5),", 
"                size = 4,", "                show.legend = F) +", 
"      scale_fill_brewer(palette = \"Set1\",", "                        name = NULL) +", 
"      scale_color_brewer(palette = \"Set1\") +", "      scale_y_continuous(labels = scales::percent) +", 
"      labs(title = \"Malaria infection status\", x = \"\", y = \"\") +", 
"      theme_minimal()", "}", "", "checkPrevalenceCI <- function(true_prevalence, CI_lower, CI_upper){", 
"  if(true_prevalence >= CI_lower & true_prevalence <= CI_upper){", 
"    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) falls within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "  else {", "    print(paste0(\"The true prevalence (\", round(true_prevalence*100, 2),\"%) does not fall within the 95%CI (\", round(CI_lower*100, 2),\"- \", round(CI_upper*100, 2), \"%)\"))", 
"  }", "}", "", "simulate_CI <- function(census, sample_size, true_prevalence) {", 
"  sample_data <- census %>% sample_n(sample_size, replace = F)", 
"  infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"  p_hat <- infected_count / sample_size", "  SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"  CI_lower <- p_hat - Z * SE", "  CI_upper <- p_hat + Z * SE", 
"  (true_prevalence >= CI_lower) & (true_prevalence <= CI_upper)", 
"}", "", "plotCISimulationResults <- function(results, n_simulations){", 
"  results_df <- data.frame(result = results) %>% ", "                mutate(result = case_when(result == FALSE ~ \"Not within 95%CI\",", 
"                                          result == TRUE ~ \"Within 95%CI\"))", 
"  ", "  results_df %>% ", "  count(result) %>% ", "  mutate(proportion = n/sum(n)) %>% ", 
"  ggplot(aes(x = \"\", y = proportion, fill = result)) +", "    geom_bar(stat = \"identity\",", 
"             position = \"fill\",", "             width = 0.5) +", 
"    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1),", 
"                  color = result), ", "            position = position_fill(vjust = 0.9), ", 
"            size = 4,", "            show.legend = F) +", "    scale_fill_manual(values = c(\"Not within 95%CI\" = \"grey\", \"Within 95%CI\" = \"magenta4\"),", 
"                      name = NULL) +", "    scale_color_manual(values = c(\"Not within 95%CI\" = \"grey30\", \"Within 95%CI\" = \"white\"),", 
"                      name = NULL) +", "    scale_y_continuous(labels = scales::percent) +", 
"    labs(title = paste0(\"Simulation results (N=\", n_simulations, \" simulations)\"), x = \"\", y = \"\") +", 
"    coord_flip() +", "    theme_minimal() +", "    theme(axis.ticks.y = element_blank(), axis.text.y = element_blank())", 
"}", "", "# PRE-LOADED DATA", "", "# fake census data", "# N <- 10000", 
"# ", "# set.seed(1234)", "# ", "# census <- data.frame(", "#   id = 1:N,", 
"#   age = sample(0:80, N, replace = TRUE), # not really realistic, eg 'young population' but maybe OK for these purposes?", 
"#   sex = sample(c(\"Male\", \"Female\"), N, replace = TRUE) #,", 
"#   # malaria_infection = sample(c(\"Infected\", \"Not infected\"), N, replace = TRUE, prob = c(0.3, 0.7)", 
"# )", "# ", "# census <- census %>% ", "#   # infection probability higher in children", 
"#   mutate(infection_prob = case_when(age >=0 & age <= 14 ~ 0.60,", 
"#                                     age > 14 & age <=44 ~ 0.30,", 
"#                                     age > 44 ~ 0.10,", "#                                     TRUE ~ 0.25),", 
"#          malaria_infection = ifelse(runif(n()) <= infection_prob, \"Infected\", \"Not infected\")) %>% ", 
"#   select(-infection_prob)", "# ", "# saveRDS(census, \"data/census.rds\")", 
"", "census <- readRDS(\"data/census.rds\")", "", "# GLOBAL PARAMS FOR EXERCISES", 
"true_infected_count <- sum(census$malaria_infection == \"Infected\")", 
"true_prevalence <- true_infected_count / 10000", "", "# get random sample", 
"# set.seed(5) # to ensure we get the same random sample for our tutorial calculations", 
"", "# set the sample size", "# sample_size <- 200", "", "# sample from the population", 
"# sample_data <- sampleFromPopulation(sample_size, census) ", 
"# saveRDS(sample_data, \"tutorials/data/sample_data.rds\")", 
"", "# sample_data <- readRDS(\"tutorials/data/sample_data.rds\")", 
"", "# Number of infected individuals in the sample", "# infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
"# ", "# p_hat <- infected_count / sample_size", "# SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
"Z <- 1.96", "# CI_lower <- p_hat - Z * SE", "# CI_upper <- p_hat + Z * SE"
), chunk_opts = list(label = "setup", include = FALSE)), setup = NULL, 
    chunks = list(list(label = "sampling-500", code = "sample_size <- 500", 
        opts = list(label = "\"sampling-500\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("sample_size <- 500", 
    "sample_data <- sampleFromPopulation(sample_size, census)", 
    "comparison <- compareSampleToPopulation(sample_data, census)", 
    "", "plotAgeSexDistribution(comparison)", "plotInfectedProportion(comparison)", 
    "", "infected_count <- sum(sample_data$malaria_infection == \"Infected\")", 
    "", "p_hat <- infected_count / sample_size", "SE <- sqrt((p_hat * (1 - p_hat)) / sample_size)", 
    "CI_lower <- p_hat - Z * SE", "CI_upper <- p_hat + Z * SE", 
    "", "checkPrevalenceCI(true_prevalence, CI_lower, CI_upper)", 
    "", "n_simulations <- 1000", "results <- replicate(n_simulations, simulate_CI(census, sample_size, true_prevalence))", 
    "plotCISimulationResults(results, n_simulations)"), chunk_opts = list(
        label = "sampling-500-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity1_sampling_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity1_sampling_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        exercise.timelimit = 120, label = "sampling-500", exercise = TRUE, 
        original.params.src = "r sampling-500, exercise=TRUE", 
        chunk.echo = FALSE, code = "sample_size <- 500", out.width.px = 672L, 
        out.height.px = 480L, params.src = "r sampling-500, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["6.5.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.min.css","css/v4-shims.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fontawesome"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["5.5.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.11.5.9000"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71]}},"value":[{"type":"character","attributes":{},"value":["backports","base","checkmate","chromote","cli","commonmark","compiler","datasets","dichromat","digest","dplyr","evaluate","farver","fastmap","fontawesome","generics","ggplot2","glue","graphics","grDevices","grid","gtable","htmltools","htmlwidgets","httpuv","httr","jquerylib","jsonlite","kableExtra","knitr","labeling","later","learnr","lifecycle","magrittr","markdown","methods","mime","pillar","pkgconfig","processx","promises","ps","R6","RColorBrewer","Rcpp","rlang","rmarkdown","rprojroot","rstudioapi","rvest","scales","shiny","stats","stringi","stringr","svglite","systemfonts","tibble","tidyselect","tools","utils","vctrs","viridisLite","webshot","websocket","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.5.0","4.3.1","2.3.2","0.5.1","3.6.5","2.0.0","4.3.1","4.3.1","2.0-0.1","0.6.37","1.1.4","1.0.4","2.1.2","1.2.0","0.5.3","0.1.4","3.5.2","1.8.0","4.3.1","4.3.1","4.3.1","0.3.6","0.5.8.1","1.6.4","1.6.16","1.4.7","0.1.4","2.0.0","1.3.4","1.50","0.4.3","1.4.2","0.11.5.9000","1.0.4","2.0.3","1.13","4.3.1","0.13","1.11.0","2.0.3","3.8.4","1.3.3","1.7.6","2.6.1","1.1-3","1.1.0","1.1.6","2.29","2.0.4","0.17.1","1.0.4","1.4.0","1.11.1","4.3.1","1.8.7","1.5.1","2.1.3","1.0.6","3.3.0","1.2.1","4.3.1","4.3.1","0.6.5","0.4.2","0.5.5","1.4.1","3.0.2","0.52","1.3.8","1.8-4","2.3.10"]}]}]}
</script>
<!--/html_preserve-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mrc-ide\.github\.io\/MMS-SD_workshop\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>