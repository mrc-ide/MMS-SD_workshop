<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Malaria Molecular Surveillance Study Design workshop - Activity 4: Dealing with over-dispersion in multi-cluster studies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Malaria Molecular Surveillance Study Design workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target=""><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html" rel="" target=""><i class="bi bi-calendar" role="img">
</i> 
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lectures.html" rel="" target=""><i class="bi bi-bookmark" role="img">
</i> 
 <span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../../tutorials.html" rel="" target="">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module2_MOE_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mms-sdworkshop.shinyapps.io/module1_sampling_interactive/" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/module6/module6_scenarios.html" rel="" target=""><i class="bi bi-play" role="img">
</i> 
 <span class="dropdown-text">Module 6</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  </ul></li>
  <li><a href="#analyzing-data-from-a-multi-cluster-pfhrp2-deletion-study" id="toc-analyzing-data-from-a-multi-cluster-pfhrp2-deletion-study" class="nav-link" data-scroll-target="#analyzing-data-from-a-multi-cluster-pfhrp2-deletion-study">Analyzing data from a multi-cluster <em>pfhrp2</em> deletion study</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#estimating-the-global-prevalence" id="toc-estimating-the-global-prevalence" class="nav-link" data-scroll-target="#estimating-the-global-prevalence">Estimating the global prevalence</a></li>
  <li><a href="#detecting-over-dispersion" id="toc-detecting-over-dispersion" class="nav-link" data-scroll-target="#detecting-over-dispersion">Detecting over-dispersion</a></li>
  </ul></li>
  <li><a href="#quantifying-over-dispersion" id="toc-quantifying-over-dispersion" class="nav-link" data-scroll-target="#quantifying-over-dispersion">Quantifying over-dispersion</a>
  <ul class="collapse">
  <li><a href="#the-design-effect" id="toc-the-design-effect" class="nav-link" data-scroll-target="#the-design-effect">The design effect</a></li>
  <li><a href="#the-effective-sample-size" id="toc-the-effective-sample-size" class="nav-link" data-scroll-target="#the-effective-sample-size">The effective sample size</a></li>
  <li><a href="#the-intra-cluster-correlation-coefficient" id="toc-the-intra-cluster-correlation-coefficient" class="nav-link" data-scroll-target="#the-intra-cluster-correlation-coefficient">The intra-cluster correlation coefficient</a></li>
  </ul></li>
  <li><a href="#accounting-for-over-dispersion" id="toc-accounting-for-over-dispersion" class="nav-link" data-scroll-target="#accounting-for-over-dispersion">Accounting for over-dispersion</a>
  <ul class="collapse">
  <li><a href="#over-dispersion-and-confidence-intervals" id="toc-over-dispersion-and-confidence-intervals" class="nav-link" data-scroll-target="#over-dispersion-and-confidence-intervals">Over-dispersion and confidence intervals</a></li>
  <li><a href="#over-dispersion-and-hypothesis-testing" id="toc-over-dispersion-and-hypothesis-testing" class="nav-link" data-scroll-target="#over-dispersion-and-hypothesis-testing">Over-dispersion and hypothesis testing</a></li>
  <li><a href="#over-dispersion-and-power" id="toc-over-dispersion-and-power" class="nav-link" data-scroll-target="#over-dispersion-and-power">Over-dispersion and power</a></li>
  <li><a href="#over-dispersion-and-sample-size" id="toc-over-dispersion-and-sample-size" class="nav-link" data-scroll-target="#over-dispersion-and-sample-size">Over-dispersion and sample size</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Activity 4: Dealing with over-dispersion in multi-cluster studies</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to Activity 4: <strong>Dealing with over-dispersion in multi-cluster studies</strong></p>
<p>In this activity, we will consider some of the features of multi-cluster studies that separate them from single-cluster studies. Very often in malaria surveillance we want to pool information over multiple sites. These could be health facilities, towns, or even regions of a country. By combining information over sites we can estimate the average value of some quantity of interest - for example the prevalence of a drug resistance mutation - without being too highly influenced by local variations. However, when pooling results, care must be taken not to overstate the amount of information we have. This is particularly true if data are <em>over-dispersed</em>, meaning there is more variation between sites than expected. In this case, our sample size is effectively diminished and in some cases power can be badly affected.</p>
<section id="learning-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h3>
<p>By the end of this tutorial, you will be able to:</p>
<ul>
<li>Detect over-dispersion</li>
<li>Quantify over-dispersion using metrics including the design effect, effective sample size, and intra-cluster correlation coefficient</li>
<li>Understand the impact of over-dispersion on statistical efficiency</li>
<li>Construct confidence intervals and perform hypothesis tests while accounting for over-dispersion</li>
</ul>
<p><em>Disclaimer: The scenarios in this document are entirely fictitious. While real place names are used, the data itself is artificial and designed for teaching purposes only. It does not necessarily represent the real epidemiological situation in these locations.</em></p>
</section>
</section>
<section id="analyzing-data-from-a-multi-cluster-pfhrp2-deletion-study" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-data-from-a-multi-cluster-pfhrp2-deletion-study">Analyzing data from a multi-cluster <em>pfhrp2</em> deletion study</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>You are collaborating with the Tanzanian National Malaria Control Programme (NMCP) to investigate the prevalence of <em>pfhrp2/3</em> gene deletions in the Dodoma region of Tanzania. These gene deletions pose a significant threat to malaria control efforts as they can lead to parasites being undetectable by rapid diagnostic tests (RDTs) that rely exclusively on the HRP2 protein. Undetected cases may lead to delays in treatment or missed malaria diagnoses, undermining effective case management.</p>
<p>A multi-cluster study has been performed in 8 sites within the Dodoma region. The results of this study are shown below:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confirmed Malaria<br>
(n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2 Deleted<br>
(x)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2 Deletion Prevalence<br>
(p)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Chalinze</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Ibwaga</td>
<td style="text-align: right; width: 3cm;">80</td>
<td style="text-align: right; width: 3cm;">12</td>
<td style="text-align: right; width: 4cm;">0.150</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Lukali</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Malolo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">26</td>
<td style="text-align: right; width: 4cm;">0.260</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Mafene</td>
<td style="text-align: right; width: 3cm;">95</td>
<td style="text-align: right; width: 3cm;">25</td>
<td style="text-align: right; width: 4cm;">0.263</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Mpendo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">45</td>
<td style="text-align: right; width: 4cm;">0.450</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Nhinhi</td>
<td style="text-align: right; width: 3cm;">50</td>
<td style="text-align: right; width: 3cm;">0</td>
<td style="text-align: right; width: 4cm;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Rudi</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">11</td>
<td style="text-align: right; width: 4cm;">0.110</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup><br>
Table 1: pfhrp2 deletion data broken down by site</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<p>In the R chunks below, you will be able to access these columns through the variables <code>n</code>, <code>x</code>, and <code>p</code>, as shown here:</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="sandbox-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can access the following vectors</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
</section>
<section id="estimating-the-global-prevalence" class="level3">
<h3 class="anchored" data-anchor-id="estimating-the-global-prevalence">Estimating the global prevalence</h3>
<p>We want to use the information over all 8 sites to estimate the prevalence of <em>pfhrp2</em> deletions in the Dodoma region as a whole. This is often called the “global” prevalence estimate. We will use <span class="math inline">\(\hat{p}\)</span> to denote the global prevalence, and <span class="math inline">\(\hat{p}_i\)</span> to denote the site-level prevalence in the <span class="math inline">\(i^\text{th}\)</span> site.</p>
<p>A common way to calculate <span class="math inline">\(\hat{p}\)</span> is to take the mean over sites.</p>
<p><span class="math display">\[
\hat{p} = \frac{1}{c} \sum_{i=1}^c \hat{p}_i
\]</span></p>
<p>where there are <span class="math inline">\(c\)</span> sites, so in our case <span class="math inline">\(c = 8\)</span>.</p>
<p>Complete the following R code to calculate <code>p_global</code> as the mean prevalence over sites. The values in <strong>Table 1</strong> are available through the variables <code>n</code>, <code>x</code> and <code>p</code>.</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="global-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as mean prevalence over sites</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="global-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as mean prevalence over sites</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> <span class="fu">mean</span>(p)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(\hat{p} = 0.172\)</span>, or 17.2% prevalence.</p>
</details>
<p><br></p>
<p>This calculation ignores differences in sample sizes between sites. For example, the Nhinhi site is given just as much weight as the Rudi site, despite having half the number of confirmed malaria cases. A different approach is to calculate <span class="math inline">\(\hat{p}\)</span> as the <em>weighted</em> average of the site-level prevalence, where the weights are given by the sample sizes. This is mathematically equivalent to summing the numerator and the denominators separately before dividing:</p>
<p><span class="math display">\[
\hat{p} = \frac{\sum_{i=1}^c x_i}{\sum_{i=1}^c n_i}
\]</span></p>
<p>Complete the following R code to calculate <code>p_global</code> as the <em>weighted</em> mean prevalence over sites:</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="global-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as weighted mean prevalence over sites</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="global-2-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate p_global as weighted mean prevalence over sites</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p_global <span class="ot">&lt;-</span> <span class="fu">sum</span>(x) <span class="sc">/</span> <span class="fu">sum</span>(n)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(\hat{p} = 0.183\)</span>, or 18.3% prevalence.</p>
</details>
<p><br></p>
<p>In this example, prevalence is slightly higher via the weighted mean than the ordinary mean. Neither approach is more correct than the other, rather they have different strengths and weaknesses. The unweighted mean treats each site as a single observation, which is a robust approach when there is the possibility of over-dispersion. On the other hand, the weighted mean avoids small clusters having a large influence on the final estimate. For the purposes of this activity, we will use the unweighted mean as our global estimate.</p>
</section>
<section id="detecting-over-dispersion" class="level3">
<h3 class="anchored" data-anchor-id="detecting-over-dispersion">Detecting over-dispersion</h3>
<p>Now that we have an estimate of the global prevalence, we can look for <em>over-dispersion</em> in the data. If all patients enrolled in the study were completely independent, meaning they all had the same probability <span class="math inline">\(\hat{p}\)</span> of carrying the <em>pfhrp2</em> deletion, then we would expect to see a certain level of variation between sites. Most of the time, the site-level prevalence should be within the following 95% interval: <span class="math display">\[
\hat{p} \pm z_{1 - \alpha/2}\sqrt{\frac{\hat{p}(1 - \hat{p})}{n_i}}
\]</span> where <span class="math inline">\(n_i\)</span> is the sample size in the <span class="math inline">\(i^{\text{th}}\)</span> site. Because this is a 95% interval, we should expect sites to fall within this range around 95% of the time. For our study involving 8 sites, we <em>may</em> see one site-level prevalence outside this range by chance, but it would be very unusual to see more than one outside this range.</p>
<p>The plot below shows the site-level prevalence in red. The global mean prevalence of 17.2% is shown as a horizontal dashed line, and the 95% interval is shown as an error bar.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="activity4_multicluster_interactive_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title"></div>
</div>
<div class="cell-output-display">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-1-1" class="tutorial-question panel-body">
<div id="quiz-overdispersion-1-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-1-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-1-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title"></div>
</div>
<div class="cell-output-display">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-2-1" class="tutorial-question panel-body">
<div id="quiz-overdispersion-2-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-2-1-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-2-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title"></div>
</div>
<div class="cell-output-display">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-3-1" class="tutorial-question panel-body">
<div id="quiz-overdispersion-3-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-3-1-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-3-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title"></div>
</div>
<div class="cell-output-display">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-overdispersion-4-1" class="tutorial-question panel-body">
<div id="quiz-overdispersion-4-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-4-1-message_container" class="shiny-html-output"></div>
<div id="quiz-overdispersion-4-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="quantifying-over-dispersion" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-over-dispersion">Quantifying over-dispersion</h2>
<section id="the-design-effect" class="level3">
<h3 class="anchored" data-anchor-id="the-design-effect">The design effect</h3>
<p>One way of quantifying the effect of over-dispersion is through the <strong>design effect</strong>, denoted <span class="math inline">\(D_{\text{eff}}\)</span>. We can estimate the design effect by calculating the observed variance between sites and dividing this by the variance that we would expect under simple random sampling (SRS). If the data are over-dispersed then the observed variance will be greater than the expected variance, meaning <span class="math inline">\(D_{\text{eff}}\)</span> will be greater than 1.</p>
<p>The observed variance between sites can be calculated as:</p>
<p><span class="math display">\[
\text{Var}_{\text{obs}} = \frac{1}{c-1}\sum_{i=1}^c (\hat{p}_i - \hat{p})^2
\]</span></p>
<p>This formula is called the <em>sample variance</em>, it is found in many areas of statistics. We don’t need to calculate this value by hand, instead we can do it very easily in R using the <code>var()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observed variance between sites</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>var_observed <span class="ot">&lt;-</span> <span class="fu">var</span>(p)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(var_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02114684</code></pre>
</div>
</div>
<p>Next, we need to calculate the variance that we would expect to see under simple random sampling (SRS). This is given by:</p>
<p><span class="math display">\[
\text{Var}_{\text{SRS}} = \frac{1}{c} \sum_{i=1}^c \frac{\hat{p}(1 - \hat{p})}{n_i}
\]</span> We can calculate this in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected variance under SRS</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>var_SRS <span class="ot">&lt;-</span> <span class="fu">mean</span>(p_global<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> n)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(var_SRS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001653192</code></pre>
</div>
</div>
<p>We calculate the design effect as the ratio of these two quantities: <span class="math display">\[
D_{\text{eff}} = \frac{\text{Var}_{\text{obs}}}{\text{Var}_{\text{SRS}}}
\]</span> Complete the following R code to calculate the design effect:</p>
<div class="cell" data-exercise="true" data-exercise.setup="deff-params">
<div class="tutorial-exercise" data-label="deff-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate design effect from the variances</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Deff <span class="ot">&lt;-</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Deff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="deff-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate design effect from the variances</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Deff <span class="ot">&lt;-</span> var_observed <span class="sc">/</span> var_SRS</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Deff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(D_{\text{eff}} = 12.79\)</span>.</p>
</details>
<p><br></p>
<p>The design effect is a measure of the statistical <em>inefficiency</em> of a study design. Larger values indicate less efficient designs, with a value of <span class="math inline">\(D_{\text{eff}}=1\)</span> representing a gold standard in terms of statistical efficiency. Our observed value of <span class="math inline">\(D_{\text{eff}}=12.79\)</span> indicates that our study has a high level of statistical inefficiency due to the over-dispersion in the data.</p>
<div class="cell">
<div class="cell-output-display">
<div class="panel-heading tutorial-quiz-title"></div>
</div>
<div class="cell-output-display">
<div class="panel panel-default tutorial-question-container">
<div data-label="quiz-deff-1-1" class="tutorial-question panel-body">
<div id="quiz-deff-1-1-answer_container" class="shiny-html-output"></div>
<div id="quiz-deff-1-1-message_container" class="shiny-html-output"></div>
<div id="quiz-deff-1-1-action_button_container" class="shiny-html-output"></div>
<script>if (Tutorial.triggerMathJax) Tutorial.triggerMathJax()</script>
</div>
</div>
</div>
</div>
</section>
<section id="the-effective-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="the-effective-sample-size">The effective sample size</h3>
<p>Another way to quantify the impact of over-dispersion is through the <em>effective sample size</em>, <span class="math inline">\(N_{\text{eff}}\)</span>. The effective sample size tells us how many perfectly independent samples we would need in order to achieve the same level of statistical efficiency. In other words, it tells us how large our study would need to be if we could get rid of over-dispersion completely. We calculate <span class="math inline">\(N_{\text{eff}}\)</span> by dividing the true total sample size by the design effect:</p>
<p><span class="math display">\[
N_{\text{eff}} = \frac{\sum_{i=1}^c n_i}{D_{\text{eff}}}
\]</span></p>
<p>Complete the following R code to calculate an effective sample size:</p>
<div class="cell" data-exercise="true" data-exercise.setup="neff-params">
<div class="tutorial-exercise" data-label="neff-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate effective sample size based on total sample size and design effect</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Neff <span class="ot">&lt;-</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Neff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="neff-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate effective sample size based on total sample size and design effect</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Neff <span class="ot">&lt;-</span> <span class="fu">sum</span>(n) <span class="sc">/</span> Deff</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Neff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(N_{\text{eff}} = 56.7\)</span>.</p>
</details>
<p><br></p>
<p>Our effective sample size is just 56.7, even though our total sample size was 725. Amazingly, this means that - from the point of view of estimating prevalence - it’s as though we had enrolled only 56 patients! The high correlation within sites meant that we were effectively sampling the same “sort” of individual over and over again. We may have been better off recruiting more sites rather than sampling deeply within a site to avoid this issue.</p>
</section>
<section id="the-intra-cluster-correlation-coefficient" class="level3">
<h3 class="anchored" data-anchor-id="the-intra-cluster-correlation-coefficient">The intra-cluster correlation coefficient</h3>
<p>The third and final measure that we will consider is the <em>intra-cluster correlation coefficient</em> (ICC), denoted <span class="math inline">\(r\)</span>. This is a measure between 0 and 1 that describes how correlated observations are <em>within</em> a cluster (site). If there is correlation with clusters then there <em>must</em> be over-dispersion in the data, and likewise if data are over-dispersed then there <em>must</em> be intra-cluster correlation greater than 0.</p>
<p>The relationship between the ICC and the design effect is:</p>
<p><span class="math display">\[
D_{\text{eff}} = 1 + r(\bar{n} - 1)
\]</span> where <span class="math inline">\(\bar{n}\)</span> is the mean sample size over sites. Notice that when <span class="math inline">\(r\)</span> is zero the design effect equals 1, indicating that we are as statistically efficient as under simple random sampling. The larger the value of <span class="math inline">\(r\)</span>, the higher the design effect and the more inefficient our design.</p>
<p>We can flip this equation around to give us the ICC as a function of the design effect:</p>
<p><span class="math display">\[
r = \frac{D_{\text{eff}} - 1}{\bar{n} - 1}
\]</span></p>
<p>Complete the following R code to calculate the value of the ICC from the design effect that we estimated above:</p>
<div class="cell" data-exercise="true" data-exercise.setup="neff-params">
<div class="tutorial-exercise" data-label="ICC-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean sample size</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>n_bar <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ICC</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ICC <span class="ot">&lt;-</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ICC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="ICC-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean sample size</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>n_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(n)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ICC</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ICC <span class="ot">&lt;-</span> (Deff <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n_bar <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ICC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that <span class="math inline">\(r = 0.132\)</span>.</p>
</details>
<p><br></p>
<p>The ICC can be harder to interpret than other measures like the design effect or effective sample size, but it does have certain advantages. We can think of the ICC as an <em>intrinsic</em> property of the population, while the design effect is only a measure of the inefficiency of <em>our study</em>. While <span class="math inline">\(D_{\text{eff}}\)</span> is influenced by <span class="math inline">\(r\)</span>, it is also influenced by many other factors, most notably the sample size. If we were to double the sample size of a study then our design effect would change, but the ICC would stay exactly the same. This makes it straightforward to compare values of <span class="math inline">\(r\)</span> between studies, while we have to take great care when comparing values of <span class="math inline">\(D_{\text{eff}}\)</span>.</p>
</section>
</section>
<section id="accounting-for-over-dispersion" class="level2">
<h2 class="anchored" data-anchor-id="accounting-for-over-dispersion">Accounting for over-dispersion</h2>
<p>We have seen what over-dispersion looks like in prevalence data, and how it can be quantified. Now we will learn how to incorporate over-dispersion into our design and analysis phases so we can be robust to its effects.</p>
<section id="over-dispersion-and-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="over-dispersion-and-confidence-intervals">Over-dispersion and confidence intervals</h3>
<p>Let’s look again at the <em>pfhrp2/3</em> data from Dodoma region:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confirmed Malaria<br>
(n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2 Deleted<br>
(x)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pfhrp2 Deletion Prevalence<br>
(p)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Chalinze</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Ibwaga</td>
<td style="text-align: right; width: 3cm;">80</td>
<td style="text-align: right; width: 3cm;">12</td>
<td style="text-align: right; width: 4cm;">0.150</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Lukali</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">7</td>
<td style="text-align: right; width: 4cm;">0.070</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Malolo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">26</td>
<td style="text-align: right; width: 4cm;">0.260</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Mafene</td>
<td style="text-align: right; width: 3cm;">95</td>
<td style="text-align: right; width: 3cm;">25</td>
<td style="text-align: right; width: 4cm;">0.263</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Mpendo</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">45</td>
<td style="text-align: right; width: 4cm;">0.450</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 3cm;">Nhinhi</td>
<td style="text-align: right; width: 3cm;">50</td>
<td style="text-align: right; width: 3cm;">0</td>
<td style="text-align: right; width: 4cm;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 3cm;">Rudi</td>
<td style="text-align: right; width: 3cm;">100</td>
<td style="text-align: right; width: 3cm;">11</td>
<td style="text-align: right; width: 4cm;">0.110</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup><br>
Table 1: pfhrp2 deletion data broken down by site</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<p>We already estimated the prevalence in the region as the mean over sites, giving <span class="math inline">\(\hat{p} = 0.172\)</span>. Now we want to construct a 95% CI around this estimate. For this, we need a modified version of the Wald interval:</p>
<p><span class="math display">\[
\hat{p} \pm z_{1 - \alpha/2}\sqrt{\frac{\hat{p}(1 - \hat{p})}{N} D_{\text{eff}}}
\]</span> Here, <span class="math inline">\(N\)</span> is the total sample size summed over all sites, which in our case is <span class="math inline">\(N = 725\)</span>. The main difference from our previous version of the Wald interval is the inclusion of the design effect, <span class="math inline">\(D_{\text{eff}}\)</span>. Notice that <span class="math inline">\(D_{\text{eff}}\)</span> <em>stretches</em> the interval, meaning a higher design effect would lead to greater uncertainty.</p>
<p>Complete the following R code to calculate a 95% CI on the global prevalence using this new version of the Wald formula. Note that you still have access to previously computed variables in this code box, including <code>n</code>, <code>x</code>, <code>p</code>, <code>p_global</code> and <code>Deff</code>:</p>
<div class="cell" data-exercise="true" data-exercise.setup="wald-params">
<div class="tutorial-exercise" data-label="Wald-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get total sample size and z</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate margin of error</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate lower and upper limits</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(CI_lower, CI_upper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="Wald-1-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get total sample size and z</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">sum</span>(n)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate margin of error</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(p_global<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> N <span class="sc">*</span> Deff)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate lower and upper limits</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> p_global <span class="sc">-</span> m</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> p_global <span class="sc">+</span> m</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(CI_lower, CI_upper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the answer
</summary>
<p>You should find that the CI ranges from 0.073 to 0.270, or in other words from 7.3% to 27.0%.</p>
</details>
<p><br></p>
<p>This CI is considerably wider than we would have obtained if we did not take over-dispersion into account. The two intervals are shown below:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="activity4_multicluster_interactive_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>If we ignored over-dispersion and treated all observations as independent, we would be in danger of over-confidence in our global prevalence estimate.</p>
</section>
<section id="over-dispersion-and-hypothesis-testing" class="level3">
<h3 class="anchored" data-anchor-id="over-dispersion-and-hypothesis-testing">Over-dispersion and hypothesis testing</h3>
<p>Similarly, when it comes to hypothesis testing, we have to factor over-dispersion into our analysis. For example, imagine we want to compare our global estimate of the prevalence of <em>pfhrp2</em> deletions against a defined threshold of 10%. The appropriate statistical test here is the one-sample z-test for proportions, which we covered in an earlier module. However, we need to use a new formula for the test statistic (<span class="math inline">\(Z\)</span>) that factors in the design effect:</p>
<p><span class="math display">\[
Z = \frac{|\hat{p} - h|}{\sqrt{\frac{\hat{p}(1 - \hat{p})}{N}D_{\text{eff}}}}
\]</span> Where <span class="math inline">\(h\)</span> is the threshold we are comparing against (<span class="math inline">\(h = 0.1\)</span>).</p>
<p>This can be calculated in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define threshold</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate test statistic</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">abs</span>(p_global <span class="sc">-</span> h) <span class="sc">/</span> <span class="fu">sqrt</span>(p_global <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_global) <span class="sc">/</span> N <span class="sc">*</span> Deff)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.430108</code></pre>
</div>
</div>
<p>We obtain a test statistic of <span class="math inline">\(Z = 1.43\)</span>. This is within the critical range <span class="math inline">\(\pm1.96\)</span>, meaning we would not reject the null hypothesis. However, if we were to run the same analysis but ignoring the design effect, we would find <span class="math inline">\(Z = 5.11\)</span>. This is highly significant, and would result in us rejecting the null hypothesis. This is an example where over-dispersion is critically important, as it dictates the result of our hypothesis test. For something like a <em>pfhrp2/3</em> study, this could mean difference between switching RDTs nationwide vs sticking with the current brand.</p>
<p><strong>Disclaimer: We do not advocate for the use of the z-test for the design pfhrp2/3 deletion studies, or the analysis of the resulting data. We will learn about a much more powerful approach to this problem in the next module.</strong></p>
</section>
<section id="over-dispersion-and-power" class="level3">
<h3 class="anchored" data-anchor-id="over-dispersion-and-power">Over-dispersion and power</h3>
<p>Addressing over-dispersion is just as critical in the design stage as it is in the analysis stage. For the one-sample z-test for proportions, we already saw the formula for power in a previous module. Now, we obtain a new formula that takes <span class="math inline">\(D_{\text{eff}}\)</span> into account:</p>
<p><span class="math display">\[
P_{\text{ow}} = 1 - \phi\left(z_{1-\alpha/2} - \frac{|p - h|}{\sqrt{\frac{p(1-p)}{N}}D_{\text{eff}}} \right)
\]</span> To make use of this formula, we have to assume known values for the true global prevalence <span class="math inline">\(p\)</span> and also the design effect <span class="math inline">\(D_{\text{eff}}\)</span>. We also have to set the total sample size <span class="math inline">\(N\)</span> and the threshold <span class="math inline">\(h\)</span>. We will assume <span class="math inline">\(p = 0.2\)</span>, <span class="math inline">\(D_{\text{eff}} = 10\)</span>, <span class="math inline">\(N = 800\)</span> and <span class="math inline">\(h = 0.1\)</span>.</p>
<p>We can calculate the power under this new formula in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define assumed parameters</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Deff <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">800</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define z-values</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected value of test statistic</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>mu_alt <span class="ot">&lt;-</span> <span class="fu">abs</span>(p <span class="sc">-</span> h) <span class="sc">/</span> <span class="fu">sqrt</span>(p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">/</span> N <span class="sc">*</span> Deff)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate power</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z_alpha <span class="sc">-</span> mu_alt)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6087521</code></pre>
</div>
</div>
<p>Under this study design we only have 61% power. Contrast this with power of 99.99998% that we obtain if we ignore the design effect! Clearly the inclusion of the design effect is severely hurting our power in this analysis, however, it is better to include it and be realistic than to ignore it and obtain results that are unreliable.</p>
</section>
<section id="over-dispersion-and-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="over-dispersion-and-sample-size">Over-dispersion and sample size</h3>
<p>When it comes to the formula for minimum sample size under the z-test, we cannot assume a known value of the design effect. This is because the design effect itself depends on the sample size, so our reasoning becomes circular. However, we can assume a known value of the ICC (<span class="math inline">\(r\)</span>).</p>
<p>Our new minimum sample size formula becomes:</p>
<p><span class="math display">\[
n = \frac{1 - r}{\frac{c(p - h)^2}{(z_{1 - \alpha/2} + z_{1 - \beta})^2 p(1-p)} - r}
\]</span></p>
<p>Note that <span class="math inline">\(n\)</span> is the sample size <em>per cluster</em>, assuming there are <span class="math inline">\(c\)</span> clusters of equal size. We can calculate this in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define assumed parameters</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span>        <span class="co"># prevalence of deletions</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.1</span>        <span class="co"># threshold to compare against</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.05</span>       <span class="co"># intra-cluster correlation</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">8</span>          <span class="co"># number of clusters</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define z-values</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>z_beta <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.8</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate minimum sample size</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> r) <span class="sc">/</span> (c<span class="sc">*</span>(p <span class="sc">-</span> h)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> ((z_alpha <span class="sc">+</span> z_beta)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">-</span> r)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69.33436</code></pre>
</div>
</div>
<p>Based on this analysis we would need 8 clusters of 70 samples. Compare this with the 8 clusters of just 16 samples we would need if we ignored intra-cluster correlation. Again, if we ignore this effect then we risk running a study that is too small, and ultimately does not have power to detect a real effect.</p>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(DRpower)
knitr::opts_chunk$set(warning = FALSE,
                      echo = FALSE)

# needed for longer calculations (eg DRpower) note - in seconds
tutorial_options(exercise.timelimit = 120)

set.seed(3)

# mock up pfhrp2 deletion data
dat <- data.frame(Site = c("Chalinze", "Ibwaga", "Lukali", "Malolo", "Mafene", "Mpendo", "Nhinhi", "Rudi")) |>
  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),
         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),
         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))

# save variables
n <- dat$Confirmed_malaria
x <- dat$pfhrp2_deleted
p <- dat$prevalence
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::prepare_tutorial_state(session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::i18n_observe_tutorial_language(input, session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::event_trigger(session, "session_stop")
      })
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-sandbox-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-sandbox-1-code-editor`)), session)
output$`tutorial-exercise-sandbox-1-output` <- renderUI({
  `tutorial-exercise-sandbox-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "sandbox-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "sandbox-1", code = "# you can access the following vectors\nn\nx\np\n", 
        opts = list(label = "\"sandbox-1\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "sandbox-1", exercise = TRUE, original.params.src = "r sandbox-1, exercise=TRUE", 
        chunk.echo = FALSE, code = c("# you can access the following vectors", 
        "n", "x", "p", ""), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r sandbox-1, exercise=TRUE", fig.num = 0, 
        exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-global-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-global-1-code-editor`)), session)
output$`tutorial-exercise-global-1-output` <- renderUI({
  `tutorial-exercise-global-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "global-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "global-1", code = "# calculate p_global as mean prevalence over sites\np_global <- \n\nprint(p_global)", 
        opts = list(label = "\"global-1\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("# calculate p_global as mean prevalence over sites", 
    "p_global <- mean(p)", "", "print(p_global)"), chunk_opts = list(
        label = "global-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "global-1", exercise = TRUE, original.params.src = "r global-1, exercise=TRUE", 
        chunk.echo = FALSE, code = c("# calculate p_global as mean prevalence over sites", 
        "p_global <- ", "", "print(p_global)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r global-1, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-global-2-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-global-2-code-editor`)), session)
output$`tutorial-exercise-global-2-output` <- renderUI({
  `tutorial-exercise-global-2-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "global-2", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = NULL, chunks = list(list(label = "global-2", code = "# calculate p_global as weighted mean prevalence over sites\np_global <- \n\nprint(p_global)", 
        opts = list(label = "\"global-2\"", exercise = "TRUE"), 
        engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = structure(c("# calculate p_global as weighted mean prevalence over sites", 
    "p_global <- sum(x) / sum(n)", "", "print(p_global)"), chunk_opts = list(
        label = "global-2-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "global-2", exercise = TRUE, original.params.src = "r global-2, exercise=TRUE", 
        chunk.echo = FALSE, code = c("# calculate p_global as weighted mean prevalence over sites", 
        "p_global <- ", "", "print(p_global)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r global-2, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-1-1", 
    question = structure("How many sites have a prevalence outside the expected 95% interval?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_e8ff70b", 
        option = "0", value = "0", label = structure("0", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_2b982af", 
        option = "2", value = "2", label = structure("2", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_5615868", 
        option = "4", value = "4", label = structure("4", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_9445895", 
        option = "6", value = "6", label = structure("6", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! There are six sites that have prevalence either above or below the 95% interval expected if all observations were independent.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: a site-level prevalence is outside the range if it is either above the upper error bar, or below the lower error bar.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: a site-level prevalence is outside the range if it is either above the upper error bar, or below the lower error bar.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-1-1-answer", question = "quiz-overdispersion-1-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1955147601.08956, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-2-1", 
    question = structure("From this plot, does the prevalence appear to be over-dispersed, under-dispersed, or neither?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_479956b", 
        option = "Over-dispersed", value = "Over-dispersed", 
        label = structure("Over-dispersed", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_1ab9295", 
        option = "Under-dispersed", value = "Under-dispersed", 
        label = structure("Under-dispersed", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_c4f0053", 
        option = "Neither", value = "Neither", label = structure("Neither", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! The presence of this many sites outside the expected range is unlikely to happen by chance, and is an indication of over-dispersion.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: ‘dispersion’ describes the spread of data. Is there more or less spread than we would expect?.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: ‘dispersion’ describes the spread of data. Is there more or less spread than we would expect?.", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-2-1-answer", question = "quiz-overdispersion-2-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 458326563.286575, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_checkbox", label = "quiz-overdispersion-3-1", 
    question = structure("What could cause this over-dispersion? Select all correct responses.", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_4474848", 
        option = "Limited migration and gene flow between sites.", 
        value = "Limited migration and gene flow between sites.", 
        label = structure("Limited migration and gene flow between sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_4e6599f", 
        option = "Variation in treatment practices leading to different selective pressures between sites.", 
        value = "Variation in treatment practices leading to different selective pressures between sites.", 
        label = structure("Variation in treatment practices leading to different selective pressures between sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_c42eb4b", 
        option = "Local outbreaks within sites, driven by infected individuals carrying *pfhrp2* deletions.", 
        value = "Local outbreaks within sites, driven by infected individuals carrying *pfhrp2* deletions.", 
        label = structure("Local outbreaks within sites, driven by infected individuals carrying <em>pfhrp2<\u002fem> deletions.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A wide range of factors can lead to over-dispersion, meaning it is extremely common in multi-cluster studies.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect. Be sure to select every correct answer.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: that is one explanation, but is it the only possible explanation?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-3-1-answer", question = "quiz-overdispersion-3-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1961562246.08658, options = list()), class = c("learnr_checkbox", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_radio", label = "quiz-overdispersion-4-1", 
    question = structure("Why does the Nhinhi site have a slightly wider 95% interval than the other sites?", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_b783ae7", 
        option = "The Nhinhi site has higher prevalence of *pfhrp2* deletions.", 
        value = "The Nhinhi site has higher prevalence of *pfhrp2* deletions.", 
        label = structure("The Nhinhi site has higher prevalence of <em>pfhrp2<\u002fem> deletions.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_99e403f", 
        option = "The diagnostic methods used at the Nhinhi site are less accurate.", 
        value = "The diagnostic methods used at the Nhinhi site are less accurate.", 
        label = structure("The diagnostic methods used at the Nhinhi site are less accurate.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_6b86b17", 
        option = "The Nhinhi site is geographically isolated.", 
        value = "The Nhinhi site is geographically isolated.", 
        label = structure("The Nhinhi site is geographically isolated.", html = TRUE, class = c("html", 
        "character")), correct = FALSE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_50b857b", 
        option = "The sample size in Nhinhi is lower than other sites.", 
        value = "The sample size in Nhinhi is lower than other sites.", 
        label = structure("The sample size in Nhinhi is lower than other sites.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A smaller sample size will lead to a wider 95% interval.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Hint: look at the formula for the 95% interval. Which factor in the formula means it will vary between sites?", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: look at the formula for the 95% interval. Which factor in the formula means it will vary between sites?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-overdispersion-4-1-answer", question = "quiz-overdispersion-4-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 1907418433.61179, options = list()), class = c("learnr_radio", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-deff-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-deff-1-code-editor`)), session)
output$`tutorial-exercise-deff-1-output` <- renderUI({
  `tutorial-exercise-deff-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "deff-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)", 
    chunks = list(list(label = "deff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)", 
        opts = list(label = "\"deff-params\""), engine = "r"), 
        list(label = "deff-1", code = "# calculate design effect from the variances\nDeff <- \n\nprint(Deff)", 
            opts = list(label = "\"deff-1\"", exercise = "TRUE", 
                exercise.setup = "\"deff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate design effect from the variances", 
    "Deff <- var_observed / var_SRS", "", "print(Deff)"), chunk_opts = list(
        label = "deff-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "deff-1", exercise = TRUE, exercise.setup = "deff-params", 
        original.params.src = "r deff-1, exercise=TRUE, exercise.setup = \"deff-params\"", 
        chunk.echo = FALSE, code = c("# calculate design effect from the variances", 
        "Deff <- ", "", "print(Deff)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r deff-1, exercise=TRUE, exercise.setup = \"deff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::question_prerendered_chunk(structure(list(type = "learnr_checkbox", label = "quiz-deff-1-1", 
    question = structure("A high value of the design effect means we can expect to see (check all correct responses):", html = TRUE, class = c("html", 
    "character")), answers = list(structure(list(id = "lnr_ans_432c475", 
        option = "Less precise estimates of the global prevalence $\\hat{p}$.", 
        value = "Less precise estimates of the global prevalence $\\hat{p}$.", 
        label = structure("Less precise estimates of the global prevalence \\(\\hat{p}\\).", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_c125479", 
        option = "Lower power.", value = "Lower power.", label = structure("Lower power.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer")), structure(list(id = "lnr_ans_c9574fc", 
        option = "Larger sample sizes needed.", value = "Larger sample sizes needed.", 
        label = structure("Larger sample sizes needed.", html = TRUE, class = c("html", 
        "character")), correct = TRUE, message = NULL, type = "literal"), class = c("tutorial_question_answer", 
    "tutorial_quiz_answer"))), button_labels = list(submit = structure("<span data-i18n=\"button.questionsubmit\">Submit Answer<\u002fspan>", html = TRUE, class = c("html", 
    "character")), try_again = structure("<span data-i18n=\"button.questiontryagain\">Try Again<\u002fspan>", html = TRUE, class = c("html", 
    "character"))), messages = list(correct = structure("That is correct! A high design effect means we have a statistically inefficient design, which will impact our precision, power, and sample size.", html = TRUE, class = c("html", 
    "character")), try_again = structure("Incorrect. Be sure to select every correct answer.", html = TRUE, class = c("html", 
    "character")), incorrect = structure("Hint: that is a correct response, but is it the only correct response?", html = TRUE, class = c("html", 
    "character")), message = NULL, post_message = NULL), ids = list(
        answer = "quiz-deff-1-1-answer", question = "quiz-deff-1-1"), 
    loading = NULL, random_answer_order = FALSE, allow_retry = TRUE, 
    seed = 553111696.742437, options = list()), class = c("learnr_checkbox", 
"tutorial_question")), session = session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-neff-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-neff-1-code-editor`)), session)
output$`tutorial-exercise-neff-1-output` <- renderUI({
  `tutorial-exercise-neff-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "neff-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
    chunks = list(list(label = "neff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
        opts = list(label = "\"neff-params\""), engine = "r"), 
        list(label = "neff-1", code = "# calculate effective sample size based on total sample size and design effect\nNeff <- \n\nprint(Neff)", 
            opts = list(label = "\"neff-1\"", exercise = "TRUE", 
                exercise.setup = "\"neff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate effective sample size based on total sample size and design effect", 
    "Neff <- sum(n) / Deff", "", "print(Neff)"), chunk_opts = list(
        label = "neff-1-solution")), tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "neff-1", exercise = TRUE, exercise.setup = "neff-params", 
        original.params.src = "r neff-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        chunk.echo = FALSE, code = c("# calculate effective sample size based on total sample size and design effect", 
        "Neff <- ", "", "print(Neff)"), out.width.px = 672L, 
        out.height.px = 480L, params.src = "r neff-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-ICC-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-ICC-1-code-editor`)), session)
output$`tutorial-exercise-ICC-1-output` <- renderUI({
  `tutorial-exercise-ICC-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "ICC-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
    chunks = list(list(label = "neff-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
        opts = list(label = "\"neff-params\""), engine = "r"), 
        list(label = "ICC-1", code = "# calculate the mean sample size\nn_bar <- \n\n# calculate the ICC\nICC <- \n\nprint(ICC)", 
            opts = list(label = "\"ICC-1\"", exercise = "TRUE", 
                exercise.setup = "\"neff-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# calculate the mean sample size", 
    "n_bar <- mean(n)", "", "# calculate the ICC", "ICC <- (Deff - 1) / (n_bar - 1)", 
    "", "print(ICC)"), chunk_opts = list(label = "ICC-1-solution")), 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "ICC-1", exercise = TRUE, exercise.setup = "neff-params", 
        original.params.src = "r ICC-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        chunk.echo = FALSE, code = c("# calculate the mean sample size", 
        "n_bar <- ", "", "# calculate the ICC", "ICC <- ", "", 
        "print(ICC)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r ICC-1, exercise=TRUE, exercise.setup = \"neff-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-Wald-1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-Wald-1-code-editor`)), session)
output$`tutorial-exercise-Wald-1-output` <- renderUI({
  `tutorial-exercise-Wald-1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "Wald-1", global_setup = structure(c("library(learnr)", 
"library(dplyr)", "library(tidyr)", "library(ggplot2)", "library(knitr)", 
"library(kableExtra)", "library(DRpower)", "knitr::opts_chunk$set(warning = FALSE,", 
"                      echo = FALSE)", "", "# needed for longer calculations (eg DRpower) note - in seconds", 
"tutorial_options(exercise.timelimit = 120)", "", "set.seed(3)", 
"", "# mock up pfhrp2 deletion data", "dat <- data.frame(Site = c(\"Chalinze\", \"Ibwaga\", \"Lukali\", \"Malolo\", \"Mafene\", \"Mpendo\", \"Nhinhi\", \"Rudi\")) |>", 
"  mutate(Confirmed_malaria = c(100, 80, 100, 100, 95, 100, 50, 100),", 
"         pfhrp2_deleted = DRpower:::rbbinom_reparam(n_clust = 8, N = Confirmed_malaria, p = 0.2, rho = 0.1),", 
"         prevalence = round(pfhrp2_deleted / Confirmed_malaria, 3))", 
"", "# save variables", "n <- dat$Confirmed_malaria", "x <- dat$pfhrp2_deleted", 
"p <- dat$prevalence"), chunk_opts = list(label = "setup", include = FALSE)), 
    setup = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
    chunks = list(list(label = "wald-params", code = "p_global <- mean(p)\nvar_observed <- var(p)\nvar_SRS <- mean(p_global*(1 - p_global) / n)\nDeff <- var_observed / var_SRS", 
        opts = list(label = "\"wald-params\""), engine = "r"), 
        list(label = "Wald-1", code = "# get total sample size and z\nN <- \nz <- 1.96\n\n# calculate margin of error\nm <- \n\n# calculate lower and upper limits\nCI_lower <- \nCI_upper <- \n\nprint(c(CI_lower, CI_upper))", 
            opts = list(label = "\"Wald-1\"", exercise = "TRUE", 
                exercise.setup = "\"wald-params\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("# get total sample size and z", 
    "N <- sum(n)", "z <- 1.96", "", "# calculate margin of error", 
    "m <- 1.96*sqrt(p_global*(1 - p_global) / N * Deff)", "", 
    "# calculate lower and upper limits", "CI_lower <- p_global - m", 
    "CI_upper <- p_global + m", "", "print(c(CI_lower, CI_upper))"
    ), chunk_opts = list(label = "Wald-1-solution")), tests = NULL, 
    options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "activity4_multicluster_interactive_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "activity4_multicluster_interactive_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = FALSE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fenced.echo = FALSE, ft.shadow = FALSE, exercise.timelimit = 120, 
        label = "Wald-1", exercise = TRUE, exercise.setup = "wald-params", 
        original.params.src = "r Wald-1, exercise=TRUE, exercise.setup = \"wald-params\"", 
        chunk.echo = FALSE, code = c("# get total sample size and z", 
        "N <- ", "z <- 1.96", "", "# calculate margin of error", 
        "m <- ", "", "# calculate lower and upper limits", "CI_lower <- ", 
        "CI_upper <- ", "", "print(c(CI_lower, CI_upper))"), 
        out.width.px = 672L, out.height.px = 480L, params.src = "r Wald-1, exercise=TRUE, exercise.setup = \"wald-params\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["6.4.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.min.css","css/v4-shims.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fontawesome"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["5.5.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.11.5.9000"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5.9000"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]}},"value":[{"type":"character","attributes":{},"value":["backports","base","checkmate","cli","colorspace","commonmark","compiler","datasets","digest","dplyr","DRpower","evaluate","extraDistr","fansi","farver","fastmap","fontawesome","generics","ggplot2","glue","graphics","grDevices","grid","gtable","htmltools","htmlwidgets","httpuv","httr","jquerylib","jsonlite","kableExtra","knitr","knitrProgressBar","labeling","later","learnr","lifecycle","magrittr","markdown","methods","mime","munsell","pillar","pkgconfig","promises","purrr","R.methodsS3","R.oo","R6","Rcpp","rlang","rmarkdown","rprojroot","rstudioapi","rvest","scales","shiny","stats","stringi","stringr","svglite","systemfonts","tibble","tidyr","tidyselect","tools","utf8","utils","vctrs","viridisLite","webshot","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.5.0","4.3.1","2.3.2","3.6.3","2.1-1","1.9.2","4.3.1","4.3.1","0.6.37","1.1.4","1.0.3","1.0.0","1.10.0","1.0.6","2.1.2","1.2.0","0.5.2","0.1.3","3.5.1","1.8.0","4.3.1","4.3.1","4.3.1","0.3.6","0.5.8.1","1.6.4","1.6.15","1.4.7","0.1.4","1.8.9","1.3.4","1.48","1.1.1","0.4.3","1.3.2","0.11.5.9000","1.0.4","2.0.3","1.13","4.3.1","0.12","0.5.1","1.9.0","2.0.3","1.3.0","1.0.2","1.8.2","1.27.0","2.5.1","1.0.13-1","1.1.4","2.28","2.0.4","0.16.0","1.0.3","1.3.0","1.9.1","4.3.1","1.8.4","1.5.1","2.1.3","1.0.6","3.2.1","1.3.1","1.2.1","4.3.1","1.2.4","4.3.1","0.6.5","0.4.2","0.5.5","3.0.2","0.48","1.3.6","1.8-4","2.3.10"]}]}]}
</script>
<!--/html_preserve-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>